import{ap as Ge,aq as Ke,ar as ae,as as M,r as g,at as Ve,au as Ns,av as js,aw as Ue,ax as An,ay as qs,az as Ps,aA as P,aB as Ce,aC as Je,aD as It,aE as Ls,aF as Fs,aG as Bs,aH as Hs,e as re,aI as Gs,aJ as Ks,aK as Nn,aL as Vs,aM as we,aN as jn,aO as Us,aP as Js,aQ as ee,aR as je,aS as Xs,aT as qn,aU as ht,aV as Zs,f as Qs,u as E,aW as Pn,aX as Ys,aY as ei,aZ as ti,z as Ln,a5 as Fn,a_ as Z,a$ as q,b0 as mt,b1 as ni,b2 as si,b3 as ii,b4 as oi,b5 as ai,b6 as Bn,b7 as qe,b8 as ri,b9 as Hn,ba as Gn,bb as ve,bc as _e,bd as Kn,be as ie,j as r,a as x,_ as ke,bf as $e,aa as Xe,c as T,C as $,a9 as gt,$ as H,T as S,bg as X,bh as wt,bi as ue,bj as ci,bk as li,bl as di,bm as ui,bn as pi,k as _,bo as fi,F as Vn,bp as Wt,bq as At,br as Pe,bs as hi,Q as Un,bt as mi,R as Jn,m as gi,U as Se,a0 as Xn,bu as Zn,bv as xi,X as Le,Z as vt,K as bi,a6 as yi,bw as Ci,bx as wi,B as Q,al as Qn,N as Yn,by as Y,s as vi,L as de,bz as Nt,a2 as R,bA as G,bB as F,S as _t,bC as jt,W as B,P as oe,bD as _i,bE as ki,bF as $i,G as Fe,bG as qt,bH as ut,H as es,I as ts,bI as Pt,a4 as Si,n as ns,ah as ss,ab as Mi,ac as Lt,O as Ei,bJ as Di,bK as Ti,bL as is,q as Be,bM as Ft,bN as Ri,bO as Oi,ad as zi,bP as Ii,aj as Wi,bQ as be,bR as Ai,ae as Ni,bS as ji,bT as qi,bU as Pi,bV as Bt,bW as Li,bX as Fi,bY as Bi,bZ as Hi,ai as Gi,ak as Ki}from"./index-yBxn32Fv.js";import{b as Vi,a as Ui}from"./char-DV8NNv1W.js";import{A as Ht,C as Ji,a as Xi,E as Zi,b as Qi}from"./CharacterEditor-DLyaGwRE.js";import{I as Yi,D as eo,W as to,d as no,a as so,u as io}from"./TrendingUp-CAxuuH8k.js";import"./discSortUtil-C2nIE0tj.js";function oo(t){return Ge("MuiCollapse",t)}Ke("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const ao=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],ro=t=>{const{orientation:e,classes:n}=t,s={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return Je(s,oo,n)},co=ae("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation],n.state==="entered"&&e.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&e.hidden]}})(({theme:t,ownerState:e})=>M({height:0,overflow:"hidden",transition:t.transitions.create("height")},e.orientation==="horizontal"&&{height:"auto",width:0,transition:t.transitions.create("width")},e.state==="entered"&&M({height:"auto",overflow:"visible"},e.orientation==="horizontal"&&{width:"auto"}),e.state==="exited"&&!e.in&&e.collapsedSize==="0px"&&{visibility:"hidden"})),lo=ae("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(t,e)=>e.wrapper})(({ownerState:t})=>M({display:"flex",width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),uo=ae("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(t,e)=>e.wrapperInner})(({ownerState:t})=>M({width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),os=g.forwardRef(function(e,n){const s=Ve({props:e,name:"MuiCollapse"}),{addEndListener:i,children:a,className:o,collapsedSize:c="0px",component:d,easing:l,in:u,onEnter:h,onEntered:p,onEntering:m,onExit:f,onExited:b,onExiting:C,orientation:y="vertical",style:w,timeout:D=Ns.standard,TransitionComponent:te=js}=s,V=Ue(s,ao),W=M({},s,{orientation:y,collapsedSize:c}),k=ro(W),A=An(),N=qs(),j=g.useRef(null),U=g.useRef(),J=typeof c=="number"?`${c}px`:c,ce=y==="horizontal",ge=ce?"width":"height",Ee=g.useRef(null),Ds=Ps(n,Ee),pe=v=>K=>{if(v){const ne=Ee.current;K===void 0?v(ne):v(ne,K)}},dt=()=>j.current?j.current[ce?"clientWidth":"clientHeight"]:0,Ts=pe((v,K)=>{j.current&&ce&&(j.current.style.position="absolute"),v.style[ge]=J,h&&h(v,K)}),Rs=pe((v,K)=>{const ne=dt();j.current&&ce&&(j.current.style.position="");const{duration:xe,easing:De}=It({style:w,timeout:D,easing:l},{mode:"enter"});if(D==="auto"){const zt=A.transitions.getAutoHeightDuration(ne);v.style.transitionDuration=`${zt}ms`,U.current=zt}else v.style.transitionDuration=typeof xe=="string"?xe:`${xe}ms`;v.style[ge]=`${ne}px`,v.style.transitionTimingFunction=De,m&&m(v,K)}),Os=pe((v,K)=>{v.style[ge]="auto",p&&p(v,K)}),zs=pe(v=>{v.style[ge]=`${dt()}px`,f&&f(v)}),Is=pe(b),Ws=pe(v=>{const K=dt(),{duration:ne,easing:xe}=It({style:w,timeout:D,easing:l},{mode:"exit"});if(D==="auto"){const De=A.transitions.getAutoHeightDuration(K);v.style.transitionDuration=`${De}ms`,U.current=De}else v.style.transitionDuration=typeof ne=="string"?ne:`${ne}ms`;v.style[ge]=J,v.style.transitionTimingFunction=xe,C&&C(v)}),As=v=>{D==="auto"&&N.start(U.current||0,v),i&&i(Ee.current,v)};return P.jsx(te,M({in:u,onEnter:Ts,onEntered:Os,onEntering:Rs,onExit:zs,onExited:Is,onExiting:Ws,addEndListener:As,nodeRef:Ee,timeout:D==="auto"?null:D},V,{children:(v,K)=>P.jsx(co,M({as:d,className:Ce(k.root,o,{entered:k.entered,exited:!u&&J==="0px"&&k.hidden}[v]),style:M({[ce?"minWidth":"minHeight"]:J},w),ref:Ds},K,{ownerState:M({},W,{state:v}),children:P.jsx(lo,{ownerState:M({},W,{state:v}),className:k.wrapper,ref:j,children:P.jsx(uo,{ownerState:M({},W,{state:v}),className:k.wrapperInner,children:a})})}))}))});os.muiSupportAuto=!0;const as=os,po=g.createContext({}),rs=po;function fo(t){return Ge("MuiAccordion",t)}const ho=Ke("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Te=ho,mo=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],go=t=>{const{classes:e,square:n,expanded:s,disabled:i,disableGutters:a}=t;return Je({root:["root",!n&&"rounded",s&&"expanded",i&&"disabled",!a&&"gutters"],region:["region"]},fo,e)},xo=ae(Ls,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`& .${Te.region}`]:e.region},e.root,!n.square&&e.rounded,!n.disableGutters&&e.gutters]}})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${Te.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${Te.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}},({theme:t})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${Te.expanded}`]:{margin:"16px 0"}}}]})),bo=g.forwardRef(function(e,n){const s=Ve({props:e,name:"MuiAccordion"}),{children:i,className:a,defaultExpanded:o=!1,disabled:c=!1,disableGutters:d=!1,expanded:l,onChange:u,square:h=!1,slots:p={},slotProps:m={},TransitionComponent:f,TransitionProps:b}=s,C=Ue(s,mo),[y,w]=Fs({controlled:l,default:o,name:"Accordion",state:"expanded"}),D=g.useCallback(ce=>{w(!y),u&&u(ce,!y)},[y,u,w]),[te,...V]=g.Children.toArray(i),W=g.useMemo(()=>({expanded:y,disabled:c,disableGutters:d,toggle:D}),[y,c,d,D]),k=M({},s,{square:h,disabled:c,disableGutters:d,expanded:y}),A=go(k),N=M({transition:f},p),j=M({transition:b},m),[U,J]=Bs("transition",{elementType:as,externalForwardedProps:{slots:N,slotProps:j},ownerState:k});return P.jsxs(xo,M({className:Ce(A.root,a),ref:n,ownerState:k,square:h},C,{children:[P.jsx(rs.Provider,{value:W,children:te}),P.jsx(U,M({in:y,timeout:"auto"},J,{children:P.jsx("div",{"aria-labelledby":te.props.id,id:te.props["aria-controls"],role:"region",className:A.region,children:V})}))]}))}),Re=bo;function yo(t){return Ge("MuiAccordionDetails",t)}Ke("MuiAccordionDetails",["root"]);const Co=["className"],wo=t=>{const{classes:e}=t;return Je({root:["root"]},yo,e)},vo=ae("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({padding:t.spacing(1,2,2)})),_o=g.forwardRef(function(e,n){const s=Ve({props:e,name:"MuiAccordionDetails"}),{className:i}=s,a=Ue(s,Co),o=s,c=wo(o);return P.jsx(vo,M({className:Ce(c.root,i),ref:n,ownerState:o},a))}),Oe=_o;function ko(t){return Ge("MuiAccordionSummary",t)}const $o=Ke("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),he=$o,So=["children","className","expandIcon","focusVisibleClassName","onClick"],Mo=t=>{const{classes:e,expanded:n,disabled:s,disableGutters:i}=t;return Je({root:["root",n&&"expanded",s&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},ko,e)},Eo=ae(Hs,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],e),[`&.${he.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${he.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${he.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${he.expanded}`]:{minHeight:64}}}]}}),Do=ae("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(t,e)=>e.content})(({theme:t})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${he.expanded}`]:{margin:"20px 0"}}}]})),To=ae("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(t,e)=>e.expandIconWrapper})(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${he.expanded}`]:{transform:"rotate(180deg)"}})),Ro=g.forwardRef(function(e,n){const s=Ve({props:e,name:"MuiAccordionSummary"}),{children:i,className:a,expandIcon:o,focusVisibleClassName:c,onClick:d}=s,l=Ue(s,So),{disabled:u=!1,disableGutters:h,expanded:p,toggle:m}=g.useContext(rs),f=y=>{m&&m(y),d&&d(y)},b=M({},s,{expanded:p,disabled:u,disableGutters:h}),C=Mo(b);return P.jsxs(Eo,M({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":p,className:Ce(C.root,a),focusVisibleClassName:Ce(C.focusVisible,c),onClick:f,ref:n,ownerState:b},l,{children:[P.jsx(Do,{className:C.content,ownerState:b,children:i}),o&&P.jsx(To,{className:C.expandIconWrapper,ownerState:b,children:o})]}))}),ze=Ro;function Oo(){const t=g.useRef(),[e,n]=g.useState(0),[s,i]=g.useState(0);return g.useEffect(()=>{const a=()=>{var o,c;n(((o=t.current)==null?void 0:o.clientWidth)??0),i(((c=t.current)==null?void 0:c.clientHeight)??0)};return a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]),{width:e,height:s,ref:t}}function zo(t){const{t:e}=re("ui"),n=Gs({path:"/:page/*"}),s=e("pageTitle"),i=t??((n==null?void 0:n.params.page)&&e(`tabs.${n==null?void 0:n.params.page}`));g.useEffect(()=>{i?document.title=`${i} - ${s}`:document.title=s},[e,s,i])}const kt={};class cs{constructor(){this.internal=new Io}ref(e){return e.reduce((n,s)=>n.get(s),this.internal)}*[Symbol.iterator](){for(const[e,n]of this.internal.entries([]))"value"in n&&(yield[[...e],n.value])}*values(){for(const e of this.internal.allRefs())"value"in e&&(yield e.value)}}let Io=class ls{constructor(){this.map=new Map}get(e){const n=this.map.get(e);if(n)return n;const s=new ls;return this.map.set(e,s),s}*allRefs(){for(const e of this.map.values())yield*e.allRefs();yield this}*entries(e){const n=e.push(void 0)-1;for(const[s,i]of this.map.entries())e[n]=s,yield*i.entries(e);e.pop(),yield[e,this]}};class ds{constructor(e,n){this.root=new Wo(e,n)}subset(e){const n=[];return this._subset(e,s=>n.push(...s[Ks])),n}_subset(e,n){const s=e.length;function i(a,o){a<s?o.subset(e[a]).forEach(c=>i(a+1,c)):n(o.leaf)}i(0,this.root)}}let Wo=class us{constructor(e,n){if(this.children=[],e>0)for(const[s,i]of Object.entries(n)){const a=new Map;for(const[o,c]of Object.entries(i))a.set(+o,new us(e-1,c));this.children.push({mask:+s,map:a})}else this.leaf=n}subset(e){return this.children.map(({mask:n,map:s})=>s.get(e&n)).filter(n=>!!n)}};class xt{constructor(e){this.root=new $t(void 0),this.keys=e}at(e){const n=this.keys.get(e),s=n.reduce((i,a)=>i.child(a),this.root);return s.leaf||(s.leaf=new St(e,n,this.keys,s)),s.leaf}}class $t{constructor(e){this.children=new Map,this.parent=e}child(e){let n=this.children.get(e);return n||(n=new $t(this),this.children.set(e,n),n)}}class St{constructor(e,n,s,i){this.tag=Object.fromEntries(Object.entries(e).filter(([a,o])=>o!=null)),this.id=n,this.keys=s,this.internal=i}with(e){const{keys:n}=this,{id:s,firstReplacedByte:i}=n.combine(this.id,e);let a=this.internal;for(let o=i;o<n.tagLen;o++)a=a.parent;for(let o=i;o<n.tagLen;o++)a=a.child(s[o]);return a.leaf||(a.leaf=new St({...this.tag,...e},s,n,a)),a.leaf}}class Ao{constructor(e,n){this.keys=new Nn(e),this.values=new ds(e.tagLen,n)}subset(e){return this.values.subset(this.keys.get(e))}}const He={sum:t=>t.reduce((e,n)=>e+n,0),prod:t=>t.reduce((e,n)=>e*n,1),min:t=>Math.min(...t),max:t=>Math.max(...t),sumfrac:([t,e])=>t/(t+e),unique:([t])=>t},Mt={match:([t,e])=>t===e?0:1,thres:([t,e])=>t>=e?0:1,lookup:([t],e)=>e[t]??0},Ie=t=>Js(t,"val");let ps=class{constructor(e,...n){const s=new Nn(e);this.nodes=new ds(s.tagLen,Vs(n)),this.cache=new xt(s).at({}),this.calc=new xt(s).at({}),this.calc.val=this}withTag(e){const n=this.calc.with(e);return n.val??(n.val=Object.assign(new this.constructor(this.cache.keys),this,{cache:this.cache.with(e),calc:n}))}gather(e){return this._gather(this.cache.with(e)).pre}compute(e){return this._compute(e,this.cache)}_gather(e){if(e.val)return e.val;const n=this.nodes.subset(e.id).flatMap(s=>s.op==="reread"?this._gather(e.with(s.tag)).pre:[this.markGathered(e.tag,s,this._compute(s,e))]);return e.val={pre:n}}_compute(e,n){const s=(a,o,c,d)=>Object.freeze({val:a,meta:this.computeMeta(e,a,o,c,d)}),{op:i}=e;switch(i){case"const":return s(e.ex,[],[]);case"sum":case"prod":case"min":case"max":case"sumfrac":{const a=e.x.map(o=>this._compute(o,n));return s(He[i](Ie(a),e.ex),a,[])}case"thres":case"match":case"lookup":{const a=e.br.map(l=>this._compute(l,n)),o=Mt[i](Ie(a),e.ex),c=[...Array(e.x.length)],d=c[o]=this._compute(e.x[o],n);return s(d.val,c,a)}case"subscript":{const a=this._compute(e.br[0],n);return s(e.ex[a.val],[],[a])}case"vtag":return s(n.tag[e.ex]??"",[],[]);case"tag":{const a=n.with(e.tag),o=this._compute(e.x[0],a);return s(o.val,[o],[],a.tag)}case"dtag":{const a=e.br.map(d=>this._compute(d,n)),o=n.with(Object.fromEntries(a.map((d,l)=>[e.ex[l],d.val]))),c=this._compute(e.x[0],o);return s(c.val,[c],a,o.tag)}case"read":{const a=n.with(e.tag),o=this._gather(a),{pre:c}=o,d=e.ex??"unique";if(o[d])return o[d];if(jn()&&d==="unique"&&c.length!==1)throw new Error(`Ill-form read for ${Us(a.tag)}`);const l=He[d](Ie(c),void 0);return o[d]=s(l,c,[],a.tag)}case"custom":{const a=e.x.map(o=>this._compute(o,n));return s(kt[e.ex].calc(Ie(a)),a,[])}default:we(i)}}markGathered(e,n,s){return s}computeMeta(e,n,s,i,a){}toDebug(){throw"Not implemented"}};function No(t,e,n){function s(o,c){if(o.val)return o.val;const d=n(o.tag);return o.val=d?[je(d,c)]:e.nodes.subset(o.id).flatMap(l=>l.op!=="reread"?a(l,o):s(o.with(l.tag),c)),o.val}function i(o,c,d){return o.every(l=>l.op==="const")?ee(He[c](o.map(l=>l.ex),d)):{op:c,x:o,br:[]}}function a(o,c){const{op:d}=o;switch(d){case"const":return o;case"read":{const l=s(c.with(o.tag),o.ex);return o.ex===void 0?l[0]??ee(void 0):i(l,o.ex,o.ex)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const l=o.x.map(u=>a(u,c));return i(l,d,o.ex)}case"thres":case"match":case"lookup":{const l=o.br.map(u=>a(u,c));if(l.every(u=>u.op==="const")){const u=Mt[o.op](l.map(h=>h.ex),o.ex);return a(o.x[u],c)}return{...o,x:o.x.map(u=>a(u,c)),br:l}}case"subscript":{const l=a(o.br[0],c);return l.op==="const"?ee(o.ex[l.ex]):{...o,br:[l]}}case"vtag":return ee(c.tag[o.ex]??"");case"tag":return a(o.x[0],c.with(o.tag));case"dtag":{const l=o.br.map(h=>a(h,c));if(l.some(h=>h.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const u=c.with(Object.fromEntries(l.map((h,p)=>[o.ex[p],h.ex])));return a(o.x[0],u)}case"custom":return{...o,x:o.x.map(l=>a(l,c))};default:we(d)}}return t.map(o=>a(o,new xt(e.cache.keys).at({})))}function Me(t,e){const n=new Map;function s(i){const a=n.get(i);if(a)return a;const o=i,c=Ne(i.x,s),d=Ne(i.br,s);(i.x!==c||i.br!==d)&&(i={...i,x:c,br:d});const l=e(i,o);return n.set(i,l),l}return Ne(t,s)}function jo(t,e){const n=new Map;function s(i){const a=n.get(i);if(a)return a;const o=e(i,s);return n.set(i,o),o}return Ne(t,s)}function bt(t,e){const n=new Set;function s(i){n.has(i)||(e(i,s),n.add(i))}t.forEach(s)}function Ne(t,e){const n=t.map(e);return t.every((s,i)=>s===n[i])?t:n}const Et={arithmetic:He,branching:Mt};class qo extends ps{constructor(e,n,s=()=>!0){super(e.cache.keys),this.gathering=new Set,this.nodes=e.nodes,this.tagStr=n,this.filter=s,this.cache=this.cache.with(e.cache.tag)}withTag(e){throw new Error("Unimplemented")}_gather(e){if(this.gathering.has(e))throw new Error("Loop detected");this.gathering.add(e);const n=this.__gather(e);return this.gathering.delete(e),n}__gather(e){if(e.val)return e.val;const n=[];this.nodes._subset(e.id,i=>n.push(...i[Xs]??[]));const s=this.nodes.subset(e.id).flatMap((i,a)=>i.op==="reread"?this._gather(e.with(i.tag)).pre.map(o=>[o,i,a]):[[this._compute(i,e),i,a]]).map(([i,a,o])=>this.markGathered(e.tag,a,i,n[o]));return e.val={pre:s}}_compute(e,n){try{return super._compute(e,n)}catch(s){return{val:NaN,meta:{formula:`err: ${s.message} in ${this.tagStr(n.tag)}: ${Gt(e,this.tagStr)}`,deps:[],isRead:!0,toJSON:Kt(this.tagStr)}}}}markGathered(e,n,{val:s,meta:i},a){return i={...i,readSeq:[...i.readSeq??[],a]},Object.freeze({val:s,meta:i})}computeMeta(e,n,s,i,a){typeof n!="number"?n=`"${n}"`:Math.round(n)===n?n=`${n}`:n=n.toFixed(2);const o={formula:`[${n}] ${Gt(e,this.tagStr)}`,deps:[...s.map(c=>c==null?void 0:c.meta).filter(c=>!!c),...i.map(c=>c.meta)].flatMap(c=>c.isRead?[c]:c.deps),isRead:e.op==="read",toJSON:Kt(this.tagStr)};if(e.op==="read"){a=Object.fromEntries(Object.entries(a).filter(([l,u])=>u)),o.deps=s.map(l=>l.meta);const c=o.deps.length;o.deps=o.deps.filter(this.filter);const d=c-o.deps.length;o.formula=`gather ${s.length} node(s) (${d} filtered) for ${this.tagStr(e.tag)} (${this.tagStr(a)})`}return o}}function Gt(t,e=n=>JSON.stringify(n)){return jo([t],(n,s)=>{const{op:i,tag:a,br:o,x:c}=n;let{ex:d}=n;if(i==="const")return`${d}`;if(i==="read")return e(a,d);i==="subscript"&&(d=void 0);const l=[];return d&&l.push(JSON.stringify(d)),a&&l.push(e(a)),l.push(...o.map(s),...c.map(s)),`${i}(`+l.join(", ")+")"})[0]}function Kt(t){return function(){const{readSeq:e,formula:n,deps:s}=this;let i;if(e!=null&&e.some(a=>!!a)){const[a,...o]=e;let c="";for(let d=o.length-1;d>=0;d--)if(o[d]){const{tag:l,value:u}=o[d];c+=`${t(l)} <= ${t(u.tag)} : `}else c+="!! : ";i=c+(a?`matches ${t(a.tag)}`:"!!")}return{...i&&{readSeq:i},formula:n,deps:s}}}const{arithmetic:Vt}=Et;function Po(t){return t=Lo(t),t=Fo(t),t=Bo(t),t}function Lo(t){return Me(t,e=>{const{op:n}=e;switch(n){case"sum":case"prod":case"min":case"max":if(e.x.length===1)return e.x[0];if(e.x.some(s=>s.op===n)){const s=e.x.flatMap(i=>i.op===n?i.x:[i]);return{...e,x:s}}}return e})}function Fo(t){return Me(t,e=>{const{op:n}=e;switch(n){case"sum":case"prod":case"min":case"max":{const s=e.x.filter(i=>i.op==="const");if(s.length>1){const i=e.x.filter(o=>o.op!=="const"),a=Vt[n](s.map(o=>o.ex),e.ex);return a===Vt[n]([],e.ex)?{...e,x:i}:{...e,x:[ee(a),...i]}}}}return e})}function Bo(t){const e=new Map,n=new cs;return Me(t,s=>{const{op:i}=s,a=s.x.map(l=>e.get(l)),o=s.br.map(l=>e.get(l));let c;switch(i){case"read":{const l=Object.keys(s.tag).sort();c=[i,s.ex,...l,...l.map(u=>s.tag[u])];break}case"sum":case"prod":case"min":case"max":c=[i,...a.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":c=[i,s.ex,...a,...o];break;case"match":c=[i,s.ex,...a,...o.sort()];break;default:we(i)}const d=n.ref(c);return"value"in d?d.value:(d.value=s,e.set(s,e.size),s)})}const{arithmetic:Ho,branching:Go}=Et;function Ko(t,e,n,s,i){const a=new Vo(t,s,e,n);for(;a.progress;)a.progress=!1,Uo(a),Jo(a,1),Zo(a),Xo(a,i);return a.setNodes(Po(a.nodes)),a}class Vo{constructor(e,n,s,i){this.progress=!0,this.nodes=e,this.minimum=n,this.candidates=s,this.cat=i}setNodes(e,n){this.nodes!==e&&(this.progress=!0,this.nodes=e,n!==void 0&&(this.minimum=n),this._nodeRanges=void 0,this._monotonicities=void 0)}setCandidates(e,n){this.candidates!==e&&(this.progress=!0,this.candidates=e,this._cndRanges=n,this._nodeRanges=void 0,this._monotonicities=void 0)}get cndRanges(){return this._cndRanges??(this._cndRanges=this.candidates.map(yt))}get nodeRanges(){return this._nodeRanges??(this._nodeRanges=fs(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return this._monotonicities??(this._monotonicities=Qo(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}function Uo(t){const{nodes:e,nodeRanges:n}=t,s=Me(e,(i,a)=>{const o=n.get(a);if(o.min===o.max)return a.op==="const"?i:ee(o.min);switch(a.op){case"thres":{const[c,d]=a.br.map(l=>n.get(l));if(c.min>=d.max)return i.x[0];if(c.max<d.min)return i.x[1];break}case"min":{const c=i.x.filter((d,l)=>n.get(a.x[l]).min<=o.max);if(c.length===1)return c[0];if(c.length!==i.x.length)return Zs(...c);break}case"max":{const c=i.x.filter((d,l)=>n.get(a.x[l]).max>=o.min);if(c.length===1)return c[0];if(c.length!==i.x.length)return ht(...c);break}case"match":case"lookup":if(i.br.every(c=>c.op==="const")){const c=i.br.map(d=>d.ex);return i.x[Go[a.op](c,a.ex)]}break;case"subscript":if(i.br[0].op==="const")return ee(i.ex[i.br[0].ex]);break}return i});t.setNodes(s)}function Jo(t,e){const{nodeRanges:n,minimum:s,cat:i}=t,a=[...t.candidates],o=[...t.cndRanges],c=[],d=[];let l=!1;if(t.nodes.forEach((h,p)=>{if(p<s.length){if(s[p]>n.get(h).min)l=!0;else if(p>=e)return;d.push(s[p])}c.push(h)}),d.length!=s.length&&t.setNodes(c,d),!l)return;let u=!1;a.forEach((h,p)=>{const m=o[p],f=h.filter(b=>{o[p]=yt([b]);const C=fs(c,i,o);return d.every((y,w)=>C.get(c[w]).max>=y)});f.length!=h.length?(a[p]=f,o[p]=yt(f),u=!0):o[p]=m}),u&&t.setCandidates(a,o)}function Xo(t,e){const n=[...t.monotonicities],s=t.candidates.map(l=>l.map(u=>{const h={incomp:[],inc:{},c:u};for(const[p,m]of n)m.inc?h.inc[p]=u[p]??0:m.dec?h.inc[p]=-(u[p]??0):h.incomp.push(u[p]??0);return h})),i=s[0][0];if(i===void 0)return;const a=Object.keys(i.inc),o=[...a].reverse(),c=!!i.incomp.length,d=s.map(l=>{const u=new cs;return c?l.forEach(h=>{const p=u.ref(h.incomp);p.value?p.value.push(h):p.value=[h]}):u.ref([]).value=l,[...u.values()].flatMap(h=>(h.sort(({inc:p},{inc:m})=>{const f=o.find(b=>p[b]!==m[b]);return f===void 0?0:m[f]-p[f]}),h.filter(({inc:p},m)=>{let f=0;for(let b=0,C=m-e;b<=C+f;b++){const y=h[b].inc;if(a.every(w=>y[w]>=p[w])&&++f>=e)return!1}return!0})))});d.some((l,u)=>l.length!=t.candidates[u].length)&&t.setCandidates(d.map(l=>l.map(u=>u.c)))}const se=Symbol();function Zo(t){const{nodes:e,cat:n,candidates:s}=t,i=new Map;bt(e,(p,m)=>{if(p.x.forEach(m),p.br.forEach(m),p.br.length)return;const f=p.x.map(C=>i.get(C));if(f.some(C=>!C))return;let b;switch(p.op){case"sum":{b={[se]:f.reduce((C,y)=>C+y[se],0)};for(const C of f)for(const[y,w]of Object.entries(C))b[y]=(b[y]??0)+w;break}case"prod":{const C=p.x.findIndex(w=>w.op!=="const");if(p.x.find((w,D)=>w.op!=="const"&&D!==C))return;b={...f[C]};const y=f.reduce((w,D,te)=>te===C?w:w*D[se],1);y!=1&&(Object.keys(b).forEach(w=>b[w]*=y),b[se]*=y);break}case"read":b={[p.tag[n]]:1,[se]:0};break;case"const":if(typeof p.ex!="number")return;b={[se]:p.ex};break;default:return}i.set(p,b)});const a=new Map;bt(e,(p,m)=>{const f=i.get(p);f&&Object.keys(f).length?a.set(p,f):(p.x.forEach(m),p.br.forEach(m))});let o=new Map([...a.values()].map(p=>{const m=Object.keys(p).sort();return m.length===1&&p[m[0]]===1?[p,m[0]]:[p,""+m.flatMap(f=>[f,p[f]]).join("")]}));if(!jn()){const p=new Map([...o.values()].map((m,f)=>[m,`c${f}`]));o=new Map([...o].map(([m,f])=>[m,p.get(f)]))}const c=s.map(p=>p.map(m=>{const f={id:m.id};return o.forEach((b,C)=>{b in f||(f[b]=Object.entries(C).reduce((y,[w,D])=>y+(m[w]??0)*D,0))}),f})),d=[...new Set(o.values())],l=new Map;for(const p of c)for(const m of d){const f=new Map;for(const y of p)f.set(y[m],(f.get(y[m])??0)+1);let[b,C]=[0,f.get(0)??0];for(const[y,w]of f)w>C&&([b,C]=[y,w]);if(b!==0){for(const y of p)y[m]-=b;l.set(m,(l.get(m)??0)+b)}for(const y of p)y[m]===0&&delete y[m]}let u=!!l.size;if(u||(u=[...a.keys()].some(p=>{if(p.op==="const"||p.op==="read")return!1;if(p.op==="sum"&&p.x.length===2){if(p.x[0].op==="const"&&p.x[1].op==="read")return!1;if(p.x[1].op==="const"&&p.x[0].op==="read")return!1}return!0})),!u)return;const h=new Map;for(const[p,m]of o){let f=je({[n]:m},void 0);p[se]+=l.get(m)??0,p[se]!==0&&(f=qn(p[se],f)),h.set(p,f)}t.setCandidates(c),t.setNodes(Me(e,(p,m)=>{const f=a.get(m);return f?h.get(f):p}))}function yt(t){const e=t.values(),n=e.next().value;if(!n)return{};const s=Object.fromEntries(Object.entries(n).map(([i,a])=>[i,{min:a,max:a}]));for(const i of e){for(const[a,o]of Object.entries(s)){const c=i[a]??0;o.min>c&&(o.min=c),o.max<c&&(o.max=c)}for(const[a,o]of Object.entries(i))a in s||(s[a]={min:Math.min(0,o),max:Math.max(0,o)})}return s}function fs(t,e,n){const s=new Map;return bt(t,(i,a)=>{i.x.forEach(a),i.br.forEach(a);const o=i.x.map(h=>s.get(h)),c=o.map(h=>h.min),d=o.map(h=>h.max);function l(h,[p,m]){const f=Ho[h],b=[f([p.min,m.min],void 0),f([p.min,m.max],void 0),f([p.max,m.min],void 0),f([p.max,m.max],void 0)];return{min:Math.min(...b),max:Math.max(...b)}}let u;switch(i.op){case"const":typeof i.ex=="number"?u={min:i.ex,max:i.ex}:u={min:NaN,max:NaN};break;case"sum":u={min:c.reduce((h,p)=>h+p,0),max:d.reduce((h,p)=>h+p,0)};break;case"prod":u={min:1,max:1},u=o.reduce((h,p)=>l(i.op,[h,p]),u);break;case"min":case"max":u={min:Math[i.op](...c),max:Math[i.op](...d)};break;case"match":case"thres":u={min:Math.min(...c),max:Math.max(...d)};break;case"sumfrac":c[0]+c[1]>0||d[0]+d[1]<0?u=l(i.op,o):u={min:NaN,max:NaN};break;case"read":{u={min:0,max:0};for(const{[i.tag[e]]:h}of n)h&&(u.min+=h.min,u.max+=h.max);break}case"subscript":{if(typeof i.ex[0]!="number")u={min:NaN,max:NaN};else{u={min:1/0,max:-1/0};let{min:h,max:p}=s.get(i.br[0]);h=Math.max(0,Math.ceil(h)),p=Math.min(p,i.ex.length-1);for(let m=h;m<=p;m++){const f=i.ex[m];u.min>f&&(u.min=f),u.max<f&&(u.max=f)}u.min>u.max&&(u={min:NaN,max:NaN})}break}case"lookup":isNaN(c[0])&&isNaN(d[0])&&(c.splice(0,1),d.splice(0,1)),u={min:Math.min(...c),max:Math.max(...d)};break;case"custom":u=kt[i.ex].range(o);break;default:we(i)}s.set(i,u)}),s}function Qo(t,e,n){const s=new Map,i=[],a=new Map;function o(c,d){s.has(c)||s.set(c,{inc:!0,dec:!0});const l=s.get(c);if(d&&l.dec)l.dec=!1;else if(!d&&l.inc)l.inc=!1;else return;i.push({node:c,inc:d})}for(t.forEach(c=>o(c,!0));i.length;){const{node:c,inc:d}=i.pop();switch(c.op){case"read":a.set(c.tag[e],s.get(c));break;case"const":break;case"sum":case"min":case"max":c.x.forEach(l=>o(l,d));break;case"thres":{c.x.forEach(h=>o(h,d));const l=n.get(c.x[0]),u=n.get(c.x[1]);l.max>u.min&&(o(c.br[0],d),o(c.br[1],!d)),l.min<u.max&&(o(c.br[0],!d),o(c.br[1],d));break}case"sumfrac":{const[l,u]=c.x.map(h=>n.get(h));u.min<0&&o(c.x[0],!d),u.max>0&&o(c.x[0],d),l.min<0&&o(c.x[1],d),l.max>0&&o(c.x[1],!d);break}case"prod":{const l=n.get(c);if(l.min<0&&l.max>0)c.x.forEach(u=>o(u,!0)),c.x.forEach(u=>o(u,!1));else{const u=d===l.max>0;c.x.forEach(h=>o(h,u===n.get(h).max>0))}break}case"match":case"lookup":c.x.forEach(l=>o(l,d)),c.br.forEach(l=>o(l,!0)),c.br.forEach(l=>o(l,!1));break;case"subscript":{const{br:[l],ex:u}=c;if(typeof u[0]=="number"){let{min:h,max:p}=n.get(l);h=Math.max(0,Math.ceil(h)),p=Math.min(p,u.length-1);for(let m=h+1;m<=p;m++)if(u[m-1]<u[m]){o(l,d);break}for(let m=h+1;m<=p;m++)if(u[m-1]>u[m]){o(l,!d);break}}else o(l,!0),o(l,!1);break}case"custom":kt[c.ex].monotonicity(c.x.map(l=>n.get(l))).forEach((l,u)=>{l.inc||o(c.x[u],!d),l.dec||o(c.x[u],d)});break;default:we(c)}}return a}function Ct(t){const[e,n]=Qs();return g.useEffect(()=>t.followAny((s,i)=>i==="update"&&n()),[t,n]),e}function me(t){const{database:e}=E();return Pn(e.charOpts,t)}const{arithmetic:Yo}=Et;let ea=class extends ps{computeMeta({op:e,ex:n},s,i,a,o){const c={...Object.freeze({conds:Object.freeze({})})},d=i.filter(p=>!!p).map(p=>Ut(p,c));a.forEach(p=>Ut(p,c));function l(p,m){return!m.tag&&p?{tag:p,...m}:m}function u(p,m){return l(o,{op:p,ops:m,...c})}function h(p){const m=p.meta,f=m.conds===c.conds;return l(o,f?m:{...m,...c})}if(e==="read"&&n!==void 0){if(n==="min"||n==="max")return h(d.find(p=>p.val===s));e=n,n=void 0}switch(e){case"sum":case"prod":case"min":case"max":case"sumfrac":{let p=d;if(p.length>1){const m=Yo[e]([],n);p=p.filter(f=>f.val!==m)}return p.length===1?h(p[0]):p.length===0?u("const",[]):u(e,p)}case"const":case"vtag":case"subscript":return u("const",[]);case"match":case"thres":case"lookup":case"tag":case"dtag":return h(d[0]);case"read":return Object.freeze(h(d[0]));case"custom":return u(n,d);default:Ys(e)}}markGathered(e,n,s){let i=!1;const a=s.val,o={...Object.freeze(s.meta)};if(e.qt==="cond"){const{src:c,dst:d,sheet:l,q:u}=e;c&&l&&u&&(o.conds={[d??"All"]:{[c]:{[l]:{[u]:a}}}}),i=!0}return Object.freeze(o),i?{val:a,meta:o}:s}listFormulas(e){return this.gather(e.tag).filter(n=>n.val).map(({val:n,meta:s})=>ei.withTag(s.tag)[n])}listCondFormulas(e){return this.listFormulas(e).map(n=>this.compute(n).meta.conds).reduce(hs,{})}};function Ut(t,e){const{conds:n,...s}=t.meta;return e.conds=hs(e.conds,n),Object.isFrozen(t.meta)?t:{val:t.val,meta:s}}function hs(t,e){return ms(t,e,(n,s)=>typeof s=="number"?s:void 0)}function ms(t,e,n){const s=n(t,e);if(s!==void 0)return s;if(Object.keys(t).length<Object.keys(e).length&&([t,e]=[e,t]),!Object.keys(e).length)return t;let i=!1;const a={...t};for(const[o,c]of Object.entries(e)){const d=a[o],l=o in a?ms(d,c,n):c;d!==l&&(a[o]=l,i=!0)}return i?a:t}function ta(t){return e=>!na(e,t)}function na(t,e){var a,o;if(!t.formula||!t.deps||t.deps.length<1)return!1;const n=t.formula,s=n.includes("[0]")&&n.includes("common.count")&&e.some(c=>n.includes(c)),i=((a=t.deps[0].formula)==null?void 0:a.includes("gather 0 node"))&&((o=t.deps[0].formula)==null?void 0:o.includes("common.count"));return s&&i}class sa extends ea{toDebug(){return new qo(this,ti,ta([...Ln,...Fn]))}}function Jt(t,...e){return e.map(({tag:n,value:s})=>({tag:{...n,preset:t},value:s}))}function ia(t,...e){return e.map(({tag:n,value:s})=>({tag:{...n,src:t},value:s}))}function oa(t){const{lvl:e,promotion:n,basic:s,dodge:i,special:a,chain:o,assist:c,core:d,mindscape:l}=Z.char,{char:u,iso:h,[t.key]:p}=q.withAll("sheet",[]);return[u.reread(p),h.reread(p),e.add(t.level),s.add(t.basic),i.add(t.dodge),a.add(t.special),o.add(t.chain),c.add(t.assist),d.add(t.core),n.add(t.promotion),l.add(t.mindscape),mt.base.crit_.add(.05),mt.base.crit_dmg_.add(.5)]}function aa(t,e,n,s){return[q.sheet("agg").reread(q.sheet("wengine")),Z.common.count.sheet(t).add(1),Z.wengine.lvl.add(e),Z.wengine.modification.add(n),Z.wengine.phase.add(s)]}function ra(t,e){const{common:{count:n},initial:s}=ni(si,{sheet:"disc",et:"own"});return[q.sheet("agg").reread(q.sheet("disc")),q.withTag({sheet:"disc",qt:"initial"}).reread(q.sheet("dyn")),...Object.entries(t).map(([i,a])=>ii(s,i).sheet("dyn").add(a)),...Object.entries(e).map(([i,a])=>n.sheet(i).add(a))]}function ca(t){const e=q.with("et","team"),{own:n,enemy:s,teamBuff:i,notOwnBuff:a}=q.sheet("agg").withAll("et",[]);return[t.map(o=>q.withTag({et:"target",dst:o}).reread(q.withTag({et:"own",dst:null,src:o}))),t.flatMap(o=>{const c=n.with("src",o);return t.map(d=>c.reread(i.withTag({dst:o,src:d,name:null})))}),t.flatMap(o=>{const c=n.with("src",o);return t.filter(d=>d!==o).map(d=>c.reread(a.withTag({dst:o,src:d,name:null})))}),t.map(o=>s.reread(q.withTag({et:"enemyDeBuff",dst:null,src:o,name:null}))),t.flatMap((o,c)=>{const{stackIn:d,stackTmp:l}=q.withAll("qt",[]),u=q.withTag({src:o,et:"own"});return[u.with("qt","stackTmp").add(oi(d,0,c+1)),u.with("qt","stackOut").add(ai(l.max.with("et","team"),c+1,d))]}),t.map(o=>e.add(q.withTag({src:o,et:"own"}).sum))].flat()}function la(t){const e=Bn(qe,t);return new sa(qe,ri,e)}function da(t){return new Ao(qe,Bn(qe,t))}var Dt={},ua=Gn;Object.defineProperty(Dt,"__esModule",{value:!0});var ye=Dt.default=void 0,pa=ua(Hn()),fa=P,ha=(0,pa.default)((0,fa.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");ye=Dt.default=ha;function ma({formulasRead:t,buffsRead:e}){var d;const n=g.useContext(ve),s=(d=g.useContext(_e))==null?void 0:d.withTag(n),i=s==null?void 0:s.toDebug(),[a,o]=g.useState(!1),c=l=>(u,h)=>{o(h?l:!1)};return r($,{bgt:"dark",children:x(T,{children:[x(Re,{expanded:a==="formulas",onChange:c("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[r(ze,{expandIcon:r(ye,{}),children:"All target listings"}),r(Oe,{children:r(gt,{children:s&&i&&a==="formulas"&&s.listFormulas(t).map((l,u)=>{const h=s.compute(l),p=i.compute(l).meta,m=l.tag.name||l.tag.q;return x(ue,{children:[x(S,{children:[m,": ",h.val]}),x(Re,{children:[x(ze,{expandIcon:r(ye,{}),children:["debug for ",m]}),x(Oe,{children:["conds:",r(X,{text:ie(h.meta.conds)}),"read:",r(X,{text:ie(l)}),"formula:",r(X,{text:ie(p)})]})]})]},`${m}${u}`)})})})]}),x(Re,{expanded:a==="buffs",onChange:c("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[r(ze,{expandIcon:r(ye,{}),children:"All target buffs"}),r(Oe,{children:r(gt,{children:s&&i&&a==="buffs"&&s.listFormulas(e).map((l,u)=>{const h=s.compute(l),p=i.compute(l).meta,m=l.tag.name||l.tag.q;return x(ue,{children:[x(S,{children:[m,": ",h.val]}),x(Re,{children:[x(ze,{expandIcon:r(ye,{}),children:["debug for ",m]}),x(Oe,{children:["conds:",r(X,{text:ie(h.meta.conds)}),"read:",r(X,{text:ie(l)}),"formula:",r(X,{text:ie(p)})]})]})]},`${m}${u}`)})})})]})]})})}function ga(){var u;const t=g.useContext(ve),e=(u=g.useContext(_e))==null?void 0:u.withTag(t),n=e==null?void 0:e.toDebug(),{read:s,setRead:i}=g.useContext(Kn),a=s&&(e==null?void 0:e.compute(s)),o=s&&(n==null?void 0:n.compute(s)),c=(s==null?void 0:s.tag.name)||(s==null?void 0:s.tag.q),d=o==null?void 0:o.meta,l=d&&ie(d);return r(wt,{open:!!s,onClose:()=>i(void 0),children:x($,{bgt:"dark",children:[r(ke,{title:`Debug formula for ${c}`,action:r($e,{onClick:()=>i(void 0),children:r(Xe,{})})}),r(T,{children:r($,{bgt:"normal",children:r(T,{children:x(gt,{gap:1,children:["Computed value: ",a==null?void 0:a.val,r(H,{}),r(S,{variant:"h6",children:"Read"}),r(X,{text:ie(s)}),r(H,{}),r(S,{variant:"h6",children:"Calculator Tag"}),r(X,{text:JSON.stringify(e==null?void 0:e.cache.tag)}),r(H,{}),r(S,{variant:"h6",children:"Tag Context"}),r(X,{text:JSON.stringify(t)}),r(H,{}),r(S,{variant:"h6",children:"Conditionals"}),r(X,{text:ie(a==null?void 0:a.meta.conds)}),r(H,{}),r(S,{variant:"h6",children:"Formula"}),r(X,{text:l||""})]})})})})]})})}function xa({document:t,bgt:e="normal",collapse:n=!1}){switch(t.type){case"fields":return r(ba,{fieldsDocument:t,bgt:e});case"text":return n?r(ya,{textDocument:t}):r(gs,{textDocument:t});case"conditional":return r(ci,{conditional:t.conditional,bgt:e});default:return null}}function ba({fieldsDocument:t,bgt:e="normal"}){return x($,{bgt:e,children:[t.header&&r(li,{header:t.header,hideDivider:t.fields.length===0}),r(di,{bgt:e,fields:t.fields})]})}function gs({textDocument:t}){const e=g.useContext(_e),n=g.useContext(ve);return e?r(S,{children:ui(t.text,e.withTag(n))}):null}function ya({textDocument:t}){const[e,n]=g.useState(!1),[s,i]=g.useState(!1);return x(_,{sx:{position:"relative"},children:[!e&&r(_,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:s?"translate(0,-5px)":void 0},children:r(pi,{})}),r(as,{onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),collapsedSize:55,onClick:()=>n(a=>!a),in:e,sx:{cursor:"pointer",position:"relative",maskImage:e?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:e?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:r(gs,{textDocument:t})})]})}const xs=fi(P.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Ca({levelLow:t,levelHigh:e,setLow:n,setHigh:s,setBoth:i,dark:a=!1,disabled:o=!1,showLevelText:c=!1}){const{t:d}=re("wengine"),[l,u]=g.useState(t),[h,p]=g.useState(e),m=g.useCallback((f,b)=>{if(typeof b=="number")throw new TypeError;const[C,y]=b;u(C),p(y)},[u,p]);return g.useEffect(()=>u(t),[u,t]),g.useEffect(()=>p(e),[p,e]),x(_,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:a?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[x(_,{sx:{width:"max-content",height:32,display:"flex"},children:[c?x(Vn,{children:[r("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:d("levelSliderTitle")}),r(H,{orientation:"vertical",flexItem:!0})]}):void 0,r(At,{value:l,onChange:f=>n(Wt(f??0,0,e)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:c?"right":"center"}},disabled:o})]}),r(hi,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[l,h],onChange:m,onChangeCommitted:(f,b)=>Array.isArray(b)&&i(b[0],b[1]),valueLabelDisplay:"auto",min:0,max:Pe,step:1,marks:!0,disabled:o}),r(At,{value:h,onChange:f=>s(Wt(f??0,t,Pe)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:o})]})}const wa=30,bs=`${wa}em`,ys=22,Cs=`${ys}em`;function va({discIds:t,wengineId:e}){const{database:n}=E(),s=g.useMemo(()=>{const u={};return Object.values(t).forEach(h=>{var m;const p=(m=n.discs.get(h))==null?void 0:m.setKey;p&&(u[p]=(u[p]||0)+1)}),Object.fromEntries(Object.entries(u).map(([h,p])=>p>=4?[h,4]:p>=2?[h,2]:[h,0]).filter(([,h])=>h>0))},[n.discs,t]),[i,a]=g.useState(2),{ref:o,width:c}=Oo(),d=An();g.useEffect(()=>{if(!o.current||!c)return;const u=parseFloat(window.getComputedStyle(o.current).fontSize),h=parseFloat(d.spacing(1)),p=u*ys,m=Math.floor((c-p)/(p+h))+1,f=Math.ceil(8/m);a(f)},[o,d,c]);const l=Un(t);return x(_,{ref:o,sx:{display:"grid",gap:1,boxSizing:"border-box",gridTemplateColumns:`repeat(auto-fit,${Cs})`,gridAutoFlow:"column",gridTemplateRows:`repeat(${i}, ${bs})`,maxWidth:"100%",width:"100%"},children:[e&&r(mi,{wengineId:e}),r(_a,{bgt:"light",sets:s}),Object.values(l).filter(Jn).map(u=>r(gi,{disc:u},u.slotKey))]})}function _a({sets:t,bgt:e}){return r($,{bgt:e,sx:{width:Cs,height:bs},children:x(_,{sx:{height:"100%",width:"100%",p:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[!Object.keys(t).length&&r(S,{children:"No Disc sets"}),Object.entries(t).map(([n,s])=>x(S,{children:[r(Se,{children:s})," ",r(Xn,{setKey:n})]},n))]})})}function Xt({tag:t}){var e;return r(Zn,{color:Ea(t),children:((e=_s.subset(t)[0])==null?void 0:e.title)||t.name||t.q})}function ws(){const t=g.useContext(_e),e=g.useContext(ve);return g.useMemo(()=>t==null?void 0:t.withTag(e),[t,e])}function Tt({optTarget:t,setOptTarget:e,buttonProps:n={}}){const{t:s}=re("optimize"),i=ws();return r(vt,{title:x(_,{sx:{display:"flex",gap:1},children:[s("optTarget"),t?r(Xt,{tag:t}):null]}),...n,children:i==null?void 0:i.listFormulas(Z.listing.formulas).map((a,o)=>x(Le,{onClick:()=>e(a.tag),children:[r(xi,{children:r(Xt,{tag:a.tag})}),r(_,{sx:{display:"flex",gap:1,ml:1},children:Ta(a.tag).map(c=>r(Se,{children:c},c))})]},`${o}_${a.tag.sheet||a.tag.q}_${a.tag.name}`))})}function ka({statFilters:t,setStatFilters:e,disabled:n=!1}){const s=g.useCallback((d,l)=>{const u=structuredClone(t);typeof l>"u"?u.push({tag:d,value:0,isMax:!1,disabled:!1}):u[l].tag=d,e(u)},[e,t]),i=g.useCallback(d=>{const l=structuredClone(t);l.splice(d,1),e(l)},[e,t]),a=g.useCallback((d,l)=>{const u=structuredClone(t);u[d].value=l,e(u)},[e,t]),o=g.useCallback((d,l)=>{const u=structuredClone(t);u[d].isMax=l,e(u)},[e,t]),c=g.useCallback((d,l)=>{const u=structuredClone(t);u[d].disabled=l,e(u)},[e,t]);return x(_,{display:"flex",flexDirection:"column",gap:1,children:[t.map((d,l)=>r($a,{statFilter:d,setTarget:u=>s(u,l),delTarget:()=>i(l),setTargetValue:u=>a(l,u),setTargetisMax:u=>o(l,u),setDisabled:u=>c(l,u),disabled:n},l+JSON.stringify(d))),r(Tt,{setOptTarget:d=>s(d)})]})}function $a({statFilter:t,setTarget:e,delTarget:n,setTargetValue:s,setTargetisMax:i,setDisabled:a,disabled:o}){const{tag:c,value:d,isMax:l,disabled:u}=t,h=bi(c.name??c.q??"");return x(_,{sx:{display:"flex",gap:1},children:[x(yi,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%",flexGrow:1},children:[r(Q,{color:u?"secondary":"success",onClick:()=>a(!u),disabled:o,size:"small",children:u?r(Ci,{}):r(wi,{})}),r(Tt,{optTarget:c,setOptTarget:e,buttonProps:{sx:{flexGrow:1},size:"small"}}),r(Q,{onClick:()=>i(!l),size:"small",children:r("strong",{children:l?"<=":">="})})]}),r(Yn,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:o,onChange:s,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:x(Qn,{position:"end",sx:{ml:0},children:[h?"%":void 0," ",r($e,{"aria-label":"Delete Stat Constraint",onClick:n,edge:"end",children:r(xs,{fontSize:"small"})})]})}})]})}function Sa({disabled:t=!1}){const{t:e}=re("page_character_optimize"),{optConfigId:n,optConfig:{statFilters:s}}=g.useContext(Y),{database:i}=E(),a=g.useCallback(o=>i.optConfigs.set(n,{statFilters:o}),[i,n]);return r(_,{children:x($,{bgt:"light",children:[r(T,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:x(_,{display:"flex",justifyContent:"space-between",children:[r(S,{sx:{fontWeight:"bold"},children:e("constraintFilter.title")}),r(Yi,{title:r(S,{children:e("constraintFilter.tooltip")})})]})}),r(H,{}),r(ka,{statFilters:s,setStatFilters:a,disabled:t})]})})}const Ma=["crit_","crit_dmg_","hp","atk","def","impact","pen","pen_","enerRegen","anomProf","anomMas","dmg_"].map(t=>{if(vi.includes(t)){const e={...Z.final.dmg_.tag,attribute:t.slice(0,-5)};return{title:r(de,{statKey:t}),fieldRef:e}}return t==="crit_"?{fieldRef:Z.common.cappedCrit_.tag,title:r(de,{statKey:t})}:{fieldRef:Z.final[t].tag,title:r(de,{statKey:t})}}),vs=[];Ma.forEach(t=>{vs.push({tag:t.fieldRef,value:t})});const _s=da(vs);function Ea(t){const{attribute:e}=t;if(e)return e}function Da(t){const{q:e}=t;return e==="dmg"}function Ta(t){const{damageType1:e,damageType2:n}=t,s=[];return Da(t)?(e&&s.push(e),n&&s.push(n),s):[]}function O(t,e){return[(n,s)=>r(Nt,{ns:`${t}_${e}_gen`,key18:n,values:s}),(n,s)=>r(Nt,{ns:`${t}_${e}`,key18:n,values:s})]}function L(t){let e=t.q;return e==="dmg_"&&t.attribute&&(e=`${t.attribute}_dmg_`),{title:r(de,{statKey:e}),fieldRef:t}}const Ze="AstralVoice",[Zt,Ra]=O("disc",Ze),Qt=R(Ze),Oa=G[Ze],za=F[Ze],Ia={2:{title:r(z,{}),img:Qt,documents:[{type:"text",text:Zt("desc2")}]},4:{title:r(I,{}),img:Qt,documents:[{type:"text",text:Zt("desc4")},{type:"conditional",conditional:{label:Ra("set4_cond"),metadata:Oa.astral,fields:[L(za.set4_team_dmg_.tag)]}}]}},Qe="BranchBladeSong",[Yt,Wa]=O("disc",Qe),en=R(Qe),Aa=G[Qe],tn=F[Qe],Na={2:{title:r(z,{}),img:en,documents:[{type:"text",text:Yt("desc2")}]},4:{title:r(I,{}),img:en,documents:[{type:"text",text:Yt("desc4")},{type:"fields",fields:[L(tn.set4_passive.tag)]},{type:"conditional",conditional:{label:Wa("set4_cond"),metadata:Aa.apply_or_trigger,fields:[L(tn.set4_cond.tag)]}}]}},Ye="ChaosJazz",[nn,ja]=O("disc",Ye),sn=R(Ye),qa=G[Ye],We=F[Ye],Pa={2:{title:r(z,{}),img:sn,documents:[{type:"text",text:nn("desc2")}]},4:{title:r(I,{}),img:sn,documents:[{type:"text",text:nn("desc4")},{type:"fields",fields:[L(We.set4_passive_fire_dmg_.tag),L(We.set4_passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:ja("set4_cond"),metadata:qa.while_off_field,fields:[{title:"EX Special Attack DMG",fieldRef:We.set4_off_field_special_dmg_.tag},{title:"Assist Attack Attack DMG",fieldRef:We.set4_off_field_assist_dmg_.tag}]}}]}},et="ChaoticMetal",[on,La]=O("disc",et),an=R(et),Fa=G[et],rn=F[et],Ba={2:{title:r(z,{}),img:an,documents:[{type:"text",text:on("desc2")}]},4:{title:r(I,{}),img:an,documents:[{type:"text",text:on("desc4")},{type:"fields",fields:[L(rn.set4_passive.tag)]},{type:"conditional",conditional:{label:La("set4_cond"),metadata:Fa.trigger_corruption,fields:[L(rn.set4_cond_trigger_corruption.tag)]}}]}},tt="FangedMetal",[cn,Ha]=O("disc",tt),ln=R(tt),Ga=G[tt],Ka=F[tt],Va={2:{title:r(z,{}),img:ln,documents:[{type:"text",text:cn("desc2")}]},4:{title:r(I,{}),img:ln,documents:[{type:"text",text:cn("desc4")},{type:"conditional",conditional:{label:Ha("set4_cond"),metadata:Ga.inflict_assault,fields:[L(Ka.set4_cond_inflict_assault.tag)]}}]}},ks="FreedomBlues",[dn,kc]=O("disc",ks),un=R(ks),Ua={2:{title:r(z,{}),img:un,documents:[{type:"text",text:dn("desc2")}]},4:{title:r(I,{}),img:un,documents:[{type:"text",text:dn("desc4")}]}},nt="HormonePunk",[pn,Ja]=O("disc",nt),fn=R(nt),Xa=G[nt],Za=F[nt],Qa={2:{title:r(z,{}),img:fn,documents:[{type:"text",text:pn("desc2")}]},4:{title:r(I,{}),img:fn,documents:[{type:"text",text:pn("desc4")},{type:"conditional",conditional:{label:Ja("set4_cond"),metadata:Xa.entering_combat,fields:[L(Za.set4_cond_entering_combat.tag)]}}]}},st="InfernoMetal",[hn,Ya]=O("disc",st),mn=R(st),er=G[st],tr=F[st],nr={2:{title:r(z,{}),img:mn,documents:[{type:"text",text:hn("desc2")}]},4:{title:r(I,{}),img:mn,documents:[{type:"text",text:hn("desc4")},{type:"conditional",conditional:{label:Ya("set4_cond"),metadata:er.hitting_burning_enemy,fields:[L(tr.set4_cond_hitting_burning_enemy.tag)]}}]}},it="PolarMetal",[gn,sr]=O("disc",it),xn=R(it),ir=G[it],bn=F[it],or={2:{title:r(z,{}),img:xn,documents:[{type:"text",text:gn("desc2")}]},4:{title:r(I,{}),img:xn,documents:[{type:"text",text:gn("desc4")},{type:"conditional",conditional:{label:sr("set4_cond"),metadata:ir.freeze_shatter}},{type:"fields",fields:[{title:"Basic Attack DMG",fieldRef:bn.set4_basic_dmg_.tag},{title:"Dash Attack DMG",fieldRef:bn.set4_dash_dmg_.tag}]}]}},ot="ProtoPunk",[yn,ar]=O("disc",ot),Cn=R(ot),rr=G[ot],cr=F[ot],lr={2:{title:r(z,{}),img:Cn,documents:[{type:"text",text:yn("desc2")}]},4:{title:r(I,{}),img:Cn,documents:[{type:"text",text:yn("desc4")},{type:"conditional",conditional:{label:ar("set4_cond"),metadata:rr.def_assist_or_evasive_assist,fields:[L(cr.set4_cond_def_assist_or_evasive_assist_dmg_.tag)]}}]}},at="PufferElectro",[wn,dr]=O("disc",at),vn=R(at),ur=G[at],_n=F[at],pr={2:{title:r(z,{}),img:vn,documents:[{type:"text",text:wn("desc2")}]},4:{title:r(I,{}),img:vn,documents:[{type:"text",text:wn("desc4")},{type:"fields",fields:[{title:"Ultimate DMG",fieldRef:_n.set4_dmg_.tag}]},{type:"conditional",conditional:{label:dr("set4_cond"),metadata:ur.launching_ult,fields:[L(_n.set4_cond_launching_ult_atk_.tag)]}}]}},Rt="ShockstarDisco",[kn,$c]=O("disc",Rt),$n=R(Rt),pt=F[Rt],fr={2:{title:r(z,{}),img:$n,documents:[{type:"text",text:kn("desc2")}]},4:{title:r(I,{}),img:$n,documents:[{type:"text",text:kn("desc4")},{type:"fields",fields:[{title:"Basic Attack Daze",fieldRef:pt.set4_basic_daze_.tag},{title:"Dash Attack Daze",fieldRef:pt.set4_dash_daze_.tag},{title:"Dodge Counter Daze",fieldRef:pt.set4_dodgeCounter_daze_.tag}]}]}},$s="SoulRock",[Sn,Sc]=O("disc",$s),Mn=R($s),hr={2:{title:r(z,{}),img:Mn,documents:[{type:"text",text:Sn("desc2")}]},4:{title:r(I,{}),img:Mn,documents:[{type:"text",text:Sn("desc4")}]}},rt="SwingJazz",[En,mr]=O("disc",rt),Dn=R(rt),gr=G[rt],xr=F[rt],br={2:{title:r(z,{}),img:Dn,documents:[{type:"text",text:En("desc2")}]},4:{title:r(I,{}),img:Dn,documents:[{type:"text",text:En("desc4")},{type:"conditional",conditional:{label:mr("set4_cond"),metadata:gr.chain_or_ult,fields:[L(xr.set4_cond_chain_or_ult.tag)]}}]}},ct="ThunderMetal",[Tn,yr]=O("disc",ct),Rn=R(ct),Cr=G[ct],wr=F[ct],vr={2:{title:r(z,{}),img:Rn,documents:[{type:"text",text:Tn("desc2")}]},4:{title:r(I,{}),img:Rn,documents:[{type:"text",text:Tn("desc4")},{type:"conditional",conditional:{label:yr("set4_cond"),metadata:Cr.enemy_shocked,fields:[L(wr.set4_cond_enemy_shocked_atk_.tag)]}}]}},lt="WoodpeckerElectro",[On,_r]=O("disc",lt),zn=R(lt),kr=G[lt],$r=F[lt],Sr={2:{title:r(z,{}),img:zn,documents:[{type:"text",text:On("desc2")}]},4:{title:r(I,{}),img:zn,documents:[{type:"text",text:On("desc4")},{type:"conditional",conditional:{label:_r("set4_cond"),metadata:kr.crit_basic_dodge_ex,fields:[L($r.set4_cond_crit_basic_dodge_ex_atk_.tag)]}}]}},Mr={AstralVoice:Ia,BranchBladeSong:Na,ChaosJazz:Pa,ChaoticMetal:Ba,FangedMetal:Va,FreedomBlues:Ua,HormonePunk:Qa,InfernoMetal:nr,PolarMetal:or,ProtoPunk:lr,PufferElectro:pr,ShockstarDisco:fr,SoulRock:hr,SwingJazz:br,ThunderMetal:vr,WoodpeckerElectro:Sr};function Er({setKey:t}){const e=Mr[t];return e?r($,{children:r(T,{children:x(g.Suspense,{fallback:r(_t,{width:"100%",height:"500px"}),children:[x(_,{sx:{display:"flex",gap:1,alignItems:"center"},children:[r(_,{component:jt?jt:"img",alt:"Disc Piece Image",src:R(t),sx:{maxHeight:"5em",width:"auto"}}),r(_,{children:r(S,{variant:"h6",children:r(Xn,{setKey:t})})})]}),r(B,{spacing:1,children:Object.entries(e).map(([n,s])=>r(Dr,{uiSheetElement:s},n))})]})})}):null}function Dr({uiSheetElement:t}){const{documents:e,title:n}=t;return x($,{bgt:"light",children:[r(ke,{title:n,titleTypographyProps:{variant:"h6"}}),r(H,{}),r(T,{children:r(B,{spacing:1,children:e.map((s,i)=>r(xa,{document:s},i))})})]})}function z(){return"2-Set"}function I(){return"4-Set"}function Tr(){const{database:t}=E(),{key:e}=oe(),{bonusStats:n}=me(e),s=g.useCallback((a,o,c)=>t.charOpts.setBonusStat(e,a,o,c),[t,e]),i=a=>{const o=Rr(a,e);t.charOpts.setBonusStat(e,o,0)};return x($,{children:[r(ke,{title:"Bonus Stats"}),r(H,{}),r(T,{children:x(B,{spacing:1,children:[n.map(({tag:a,value:o},c)=>r(Ir,{tag:a,value:o,setValue:d=>s(a,d,c),onDelete:()=>s(a,null,c),setTag:d=>s(d,0,c)},JSON.stringify(a)+c)),r(zr,{onSelect:i})]})})]})}function Rr(t,e){return{src:e,dst:e,et:"own",q:t,qt:"combat",sheet:"agg"}}const Or=["hp","hp_","def","def_","atk","atk_","dmg_","enerRegen_","crit_","crit_dmg_"];function zr({tag:t={},onSelect:e}){var n;return r(vt,{title:(t&&((n=_s.subset(t)[0])==null?void 0:n.title))??"Add Bonus Stat",children:Or.map(s=>r(Le,{onClick:()=>e(s),children:r(de,{statKey:s,showPercent:!0})},s))})}function Ir({tag:t,setTag:e,value:n,setValue:s,onDelete:i}){var o;const a=(o=t.name||t.q)==null?void 0:o.endsWith("_");return r($,{bgt:"light",children:x(T,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[r(Se,{sx:{m:"auto"},children:r(de,{statKey:t.q})}),t.q==="dmg_"&&r(Wr,{tag:t,setAttribute:c=>{const{attribute:d,...l}=t;e(c?{...l,attribute:c}:l)}}),r(Yn,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:s,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:x(Qn,{position:"end",sx:{ml:0},children:[a?"%":void 0," ",r($e,{"aria-label":"Delete Bonus Stat",onClick:i,edge:"end",children:r(xs,{fontSize:"small"})})]})}})]})})}function Wr({tag:t,setAttribute:e}){return x(vt,{title:t.attribute?r(Ht,{attribute:t.attribute}):"No Attribute",color:t.attribute,children:[r(Le,{onClick:()=>e(null),children:"No Attribute"}),_i.map(n=>r(Le,{onClick:()=>e(n),children:r(Zn,{color:n,children:r(Ht,{attribute:n})})},n))]})}const Ar=210,Ss=g.createContext(Ar);function Nr(){const{key:t}=oe(),{conditionals:e}=me(t),[n,s]=g.useState(""),i=g.useMemo(()=>{const a=e.map(o=>o.sheet).filter(ki);return n&&a.push(n),[...new Set(a)].sort(o=>o===n?-1:1)},[e,n]);return x(B,{spacing:1,sx:{pt:1},children:[r($i,{discSetKey:n,setDiscSetKey:s,label:"Search Disc Set"}),r(_,{children:r(Fe,{container:!0,columns:3,spacing:1,children:i.map(a=>r(Fe,{item:!0,xs:1,children:r(Er,{setKey:a})},a))})})]})}function In(t){return t.reduce((e,n)=>e*n.length,1)}const Wn=4e4;class jr{constructor(e){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.finalize=()=>{},this.terminate=()=>{};const{progress:n}=this,{topN:s,numWorkers:i,setProgress:a}=e,o=[...Array(i)].map(()=>new Worker(new URL(""+new URL("workerHandle-Dq7WUciB.js",import.meta.url).href,import.meta.url),{type:"module"})),c=Ko(e.nodes,e.candidates,"q",e.minimum,s),{nodes:d,candidates:l,minimum:u}=c;n.remaining=In(l),n.skipped=In(e.candidates)-n.remaining;const h=l.map(f=>f.map(b=>b.id));this.topN=s,this.optThreshold=u[0],this.info=new Map(o.map(f=>[f,{builds:[],giving:!1}])),this.state={ty:"work",works:[{ids:h,count:n.remaining}]},this.report=()=>a({...n}),this.results=new Promise((f,b)=>{this.finalize=C=>(this.report(),f(C)),this.terminate=b});const p=()=>o.forEach(f=>f.terminate());this.results.then(p,p);const m={ty:"init",nodes:d,minimum:u,candidates:l,topN:s};for(const f of o)f.onmessage=b=>{try{this.onWorkerMsg(b.data,f)}catch(C){this.terminate(C)}},Ae(f,m)}distribute(e){const{state:n}=this;if(n.ty==="work"){n.works.push(...e);return}for(const s of n.workers)if(this.give(e,s))n.workers.delete(s);else return;this.state={ty:"work",works:e}}idle(e){const{state:n,progress:s,info:i}=this;if(n.ty==="idle")n.workers.add(e);else{if(this.give(n.works,e))return;this.state={ty:"idle",workers:new Set([e])}}const o={ty:"work?",maxKeep:s.remaining/(i.size+1)};i.forEach((c,d)=>Ae(d,o))}give(e,n){if(!e.length)return!1;const s=this.progress.remaining/(this.info.size+2);let i=Math.ceil(Math.max(s,Wn));const a=e.findIndex(c=>(i-=c.count)<0)+1,o=e.splice(0,a||e.length);return this.info.get(n).giving=!0,Ae(n,{ty:"add",works:o}),!0}onWorkerMsg(e,n){var s;switch(e.ty){case"progress":{const i=this.progress,a=this.info.get(n);i.remaining-=e.computed+e.skipped,i.computed+=e.computed,i.failed+=e.failed,i.skipped+=e.skipped,a.builds=e.builds,e.remaining<Wn&&!a.giving&&this.idle(n);const o=[...this.info.values()].flatMap(d=>d.builds);o.sort((d,l)=>l.value-d.value);const c=((s=o[this.topN])==null?void 0:s.value)??-1/0;if(c>this.optThreshold){this.optThreshold=c;const d={ty:"config",threshold:c};this.info.forEach((l,u)=>Ae(u,d))}this.report(),this.progress.remaining||this.finalize(o);break}case"add":this.distribute(e.works);break;case"recv":this.info.get(n).giving=!1;break;case"err":this.terminate(e.msg+" (Worker Error)")}}}function Ae(t,e){t.postMessage(e)}function qr(t,e,n,s,i,a,o,c,d,l){const u=new Set(Fn),h=new Set(Ln),p=[qn(...n.map((f,b)=>qt(f.multiplier,new ut(f.tag,"sum").with("preset",`preset${b}`)))),...s.map(({tag:f,isMax:b})=>b?qt(-1,new ut(f,"sum")):new ut(f,"sum"))],m=No(p,e,f=>{if(f.src===t&&f.et==="own"){if(f.sheet==="dyn"&&f.qt==="premod")return{q:f.q};if(f.q==="count"&&u.has(f.sheet))return{q:f.sheet};if(f.qt=="wengine"&&["lvl","phase","modification"].includes(f.q))return{q:f.q};if(f.q==="count"&&h.has(f.sheet))return{q:f.sheet}}});return m.push(i.length?ht(...i.map(f=>je({q:f},"sum"))):ee(1/0),a.length?ht(...a.map(f=>je({q:f},"sum"))):ee(1/0)),new jr({nodes:m,candidates:[o.map(Pr),c[1].map(fe),c[2].map(fe),c[3].map(fe),c[4].map(fe),c[5].map(fe),c[6].map(fe)],minimum:[-1/0,...s.map(f=>f.isMax?f.value*-1:f.value),2,4],numWorkers:d,topN:10,setProgress:l})}function fe(t){const{id:e,mainStatKey:n,level:s,rarity:i,setKey:a,substats:o}=t;return{id:e,[n]:es(i,n,s),...Object.fromEntries(o.filter(({key:c,upgrades:d})=>c&&d).map(({key:c,upgrades:d})=>[c,ts(c,i)*d])),[a]:1}}function Pr(t){const{id:e,key:n,level:s,modification:i,phase:a}=t;return{id:e,lvl:s,modification:i,phase:a,[n]:1}}const Lr=g.memo(function({disabled:e=!1}){const{database:n}=E(),{optConfigId:s,optConfig:i}=g.useContext(Y);return x($,{bgt:"light",children:[r(T,{sx:{display:"flex",gap:1},children:r(S,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),r(H,{}),r(Si,{levelLow:(i==null?void 0:i.levelLow)??Pt.S,levelHigh:(i==null?void 0:i.levelHigh)??Pt.S,setLow:a=>n.optConfigs.set(s,{levelLow:a}),setHigh:a=>n.optConfigs.set(s,{levelHigh:a}),setBoth:(a,o)=>n.optConfigs.set(s,{levelLow:a,levelHigh:o}),disabled:e})]})});function Fr({discsBySlot:t}){const[e,n,s]=ns();return r($,{bgt:"light",children:r(T,{children:x(B,{spacing:1,children:[r(ue,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:ss.map(i=>r(le,{discsBySlot:t,slotKey:i},i))}),r(Br,{show:e,onClose:s,discsBySlot:t}),r(Q,{color:"info",fullWidth:!0,onClick:n,children:"Disc Filter Config"})]})})})}function le({discsBySlot:t,slotKey:e}){return x(S,{children:["Disc ",e," ",r(Se,{color:t[e].length?"primary":"error",children:t[e].length})]})}function Br({discsBySlot:t,show:e,onClose:n,disabled:s}){const{database:i}=E(),{optConfigId:a,optConfig:o}=g.useContext(Y);return r(wt,{open:e,onClose:n,children:x($,{children:[r(ke,{title:"Disc Filter",action:r($e,{onClick:n,children:r(Xe,{})})}),r(H,{}),r(T,{children:r(g.Suspense,{fallback:r(_t,{width:"100%",height:"500px"}),children:x(B,{spacing:1,children:[r(Lr,{disabled:s}),r(Hr,{discsBySlot:t,disabled:s}),r(Gr,{disabled:s}),r(Q,{disabled:s,onClick:()=>i.optConfigs.set(a,{useEquipped:!o.useEquipped}),color:o.useEquipped?"success":"secondary",children:"Use equipped Discs"})]})})})]})})}function Hr({discsBySlot:t,disabled:e}){const{database:n}=E(),{optConfigId:s,optConfig:i}=g.useContext(Y),a=o=>{const c=Mi([...Lt[o]]),d={4:i.slot4??[],5:i.slot5??[],6:i.slot6??[]},l={4:u=>n.optConfigs.set(s,{slot4:u}),5:u=>n.optConfigs.set(s,{slot5:u}),6:u=>n.optConfigs.set(s,{slot6:u})};return r(ue,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:Lt[o].map(u=>r(Q,{disabled:e,variant:d[o].includes(u)?"contained":"outlined",onClick:()=>l[o](c([...d[o]],u)),children:r(de,{statKey:u,showPercent:!0})},u))})};return r($,{bgt:"light",children:r(T,{children:x(B,{spacing:1,children:[x(ue,{sx:{display:"flex",justifyContent:"space-between"},children:[r(le,{slotKey:"1",discsBySlot:t}),r(le,{slotKey:"2",discsBySlot:t}),r(le,{slotKey:"3",discsBySlot:t})]}),r(le,{slotKey:"4",discsBySlot:t}),a("4"),r(le,{slotKey:"5",discsBySlot:t}),a("5"),r(le,{slotKey:"6",discsBySlot:t}),a("6")]})})})}function Gr({disabled:t}){const{database:e}=E(),{optConfigId:n,optConfig:s}=g.useContext(Y),{setFilter2:i=[],setFilter4:a=[]}=s,o=g.useCallback(d=>{e.optConfigs.set(n,{setFilter2:d})},[e,n]),c=g.useCallback(d=>{e.optConfigs.set(n,{setFilter4:d})},[e,n]);return r(eo,{disabled:t,setFilter2:i,setFilter4:a,setSetFilter2:o,setSetFilter4:c})}var Ot={},Kr=Gn;Object.defineProperty(Ot,"__esModule",{value:!0});var Ms=Ot.default=void 0,Vr=Kr(Hn()),Ur=P,Jr=(0,Vr.default)((0,Ur.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");Ms=Ot.default=Jr;function Xr(t){const{database:e}=E();return Pn(e.generatedBuildList,t)}const Zr=g.memo(function(){const{optConfig:e}=g.useContext(Y),n=Xr(e.generatedBuildListId??"");return r(B,{spacing:1,children:n==null?void 0:n.builds.map((s,i)=>r($,{children:x(T,{children:[x(_,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[x(S,{children:["Build ",i+1,": ",Ei(s.value)]}),r(Qr,{build:s})]}),r(va,{discIds:s.discIds,wengineId:s.wengineId})]})},`${i}-${s.wengineId}-${Object.values(s.discIds).join("-")}`))})});function Qr({build:{discIds:t,wengineId:e}}){const{t:n}=re("build"),{database:s}=E(),{key:i}=oe()??{},a=g.useCallback(()=>{i&&(Object.entries(t).forEach(([o,c])=>c&&s.discs.set(c,{location:i})),e&&s.wengines.set(e,{location:i}))},[i,t,e,s.wengines,s.discs]);return r(Q,{color:"info",size:"small",startIcon:r(Ms,{}),onClick:a,children:n("buildDisplay.equipToCrr")})}const Yr=g.memo(function({disabled:e=!1}){const{database:n}=E(),{optConfigId:s,optConfig:i}=g.useContext(Y);return x($,{bgt:"light",children:[r(T,{sx:{display:"flex",gap:1},children:r(S,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),r(H,{}),r(Ca,{levelLow:(i==null?void 0:i.wlevelLow)??Pe,levelHigh:(i==null?void 0:i.wlevelHigh)??Pe,setLow:a=>n.optConfigs.set(s,{wlevelLow:a}),setHigh:a=>n.optConfigs.set(s,{wlevelHigh:a}),setBoth:(a,o)=>n.optConfigs.set(s,{wlevelLow:a,wlevelHigh:o}),disabled:e})]})});function ec({numWengine:t,disabled:e}){const{database:n}=E(),{optConfigId:s,optConfig:i}=g.useContext(Y),[a,o,c]=ns();return r($,{bgt:"light",children:r(T,{children:x(B,{spacing:1,children:[x(ue,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[x(ue,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",r(Se,{color:t?"primary":"error",children:t})]}),r(Q,{sx:{flexGrow:1},startIcon:i.optWengine?r(Di,{}):r(Ti,{}),color:i.optWengine?"success":"secondary",onClick:()=>n.optConfigs.set(s,{optWengine:!i.optWengine}),children:"Optimize Wengine"})]}),r(tc,{show:a,onClose:c}),r(Q,{color:"info",fullWidth:!0,onClick:o,disabled:e||!i.optWengine,children:"Wengine Filter Config"})]})})})}function tc({show:t,onClose:e,disabled:n}){const{database:s}=E(),{optConfigId:i,optConfig:a}=g.useContext(Y);return r(wt,{open:t,onClose:e,children:x($,{children:[r(ke,{title:"Wengine Filter",action:r($e,{onClick:e,children:r(Xe,{})})}),r(H,{}),r(T,{children:r(g.Suspense,{fallback:r(_t,{width:"100%",height:"500px"}),children:x(B,{spacing:1,children:[r(Yr,{disabled:n}),r(nc,{disabled:n}),r(Q,{disabled:n,onClick:()=>s.optConfigs.set(i,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"})]})})})]})})}function nc({disabled:t}){const{database:e}=E(),{optConfigId:n,optConfig:s}=g.useContext(Y),{wEngineTypes:i}=s,a=Ct(e.wengines),{key:o}=oe(),c=g.useMemo(()=>a&&s.optWengine?e.wengines.values.reduce((d,{key:l,level:u,location:h})=>{if(u<s.wlevelLow||u>s.wlevelHigh||h&&!s.useEquippedWengine&&h!==o)return d;const p=is(l).type;return p&&d[p]++,d},Be(Ft,()=>0)):Be(Ft,()=>0),[o,a,e.wengines,s.wlevelLow,s.wlevelHigh,s.optWengine,s.useEquippedWengine]);return r(Ri,{onChange:d=>e.optConfigs.set(n,{wEngineTypes:d}),value:i,disabled:t,totals:c,fullWidth:!0})}function sc(){const{key:t}=oe(),{optConfigId:e}=me(t),{database:n}=E();return g.useEffect(()=>{if(e)return;const s=n.optConfigs.new({wEngineTypes:[Vi(t).specialty]});n.charOpts.set(t,{optConfigId:s})},[n,e,t]),e?x(Oi,{optConfigId:e,children:[r(ic,{}),r(Zr,{})]}):null}function ic(){const{t}=re("optimize"),{database:e}=E(),n=ws(),{key:s}=oe(),{target:i}=me(s),[a,o]=g.useState(8),[c,d]=g.useState(void 0),{optConfig:l,optConfigId:u}=g.useContext(Y),h=Ct(e.discs),p=g.useMemo(()=>{const V={4:l.slot4,5:l.slot5,6:l.slot6},W=k=>["4","5","6"].includes(k);return h&&e.discs.values.reduce((k,A)=>{const{slotKey:N,mainStatKey:j,level:U,location:J}=A;return U<l.levelLow||U>l.levelHigh||J&&!l.useEquipped&&J!==s||W(N)&&!V[N].includes(j)||k[A.slotKey].push(A),k},{1:[],2:[],3:[],4:[],5:[],6:[]})},[s,h,e.discs,l.levelHigh,l.levelLow,l.slot4,l.slot5,l.slot6,l.useEquipped]),m=Ct(e.wengines),f=g.useMemo(()=>m&&e.wengines.values.filter(({key:V,level:W,location:k})=>{if(!l.optWengine)return k===s;if(W<l.wlevelLow||W>l.wlevelHigh||k&&!l.useEquippedWengine&&k!==s)return!1;const{type:A}=is(V);return!!l.wEngineTypes.includes(A)}),[s,e.wengines,l.wlevelLow,l.wlevelHigh,l.optWengine,l.wEngineTypes,l.useEquippedWengine,m]),b=g.useMemo(()=>Object.values(p).reduce((V,W)=>V*W.length,1)*f.length,[f.length,p]),[C,y]=g.useState(!1),w=g.useRef(()=>{});g.useEffect(()=>()=>w.current(),[]);const D=g.useCallback(async()=>{if(!n)return;const V=new Promise(N=>w.current=N);d(void 0),y(!0);const W=(l.statFilters??[]).filter(({disabled:N})=>!N).map(({tag:N,value:j,isMax:U})=>({tag:N,value:j,isMax:U})),k=qr(s,n,[{tag:i,multiplier:1}],W,l.setFilter2,l.setFilter4,f,p,a,d);V.then(()=>k.terminate("user cancelled"));let A;try{A=await k.results}catch{return}finally{w.current=()=>{},y(!1)}A.length&&e.optConfigs.newOrSetGeneratedBuildList(u,{builds:A.slice(0,5).map(({ids:N,value:j})=>({wengineId:N[0],discIds:Be(ss,(U,J)=>N[J+1]),value:j})),buildDate:Date.now()})},[n,l.statFilters,l.setFilter2,l.setFilter4,s,i,f,p,a,e.optConfigs,u]),te=g.useCallback(()=>{w.current(),y(!1)},[w]);return r($,{children:r(T,{children:x(B,{spacing:1,children:[r(Sa,{}),r(ec,{numWengine:f.length}),r(Fr,{discsBySlot:p}),c&&r(oc,{progress:c,totalPermutations:b}),x(_,{sx:{display:"flex",justifyContent:"space-between"},children:[r(to,{numWorkers:a,setNumWorkers:o}),r(Q,{disabled:!b,onClick:C?te:D,color:C?"error":"primary",startIcon:C?r(Xe,{}):r(no,{}),children:t(C?"cancel":"optimize")})]})]})})})}function oc({progress:t,totalPermutations:e}){const{t:n}=re("optimize");return x(_,{children:[x(S,{children:[n("computed"),": ",t.computed.toLocaleString()," /"," ",(t.computed+t.remaining).toLocaleString()]}),x(S,{children:[n("computed + skipped"),":"," ",(t.computed+t.skipped).toLocaleString()," /"," ",e.toLocaleString()]}),r(zi,{variant:"determinate",value:(t.computed+t.skipped)/e*100})]})}function ac(){const{key:t}=oe(),{conditionals:e}=me(t),[n,s]=g.useState(""),i=g.useMemo(()=>{const a=e.map(o=>o.sheet).filter(Ii);return n&&a.push(n),[...new Set(a)].sort(o=>o===n?-1:1)},[e,n]);return x(B,{spacing:1,sx:{pt:1},children:[r(so,{wkey:n,setWKey:s}),r(_,{children:r(Fe,{container:!0,columns:3,spacing:1,children:i.map(a=>x(Fe,{item:!0,xs:1,children:["TODO: WengineSheetDisplay for ",a]},a))})})]})}const rc=0,ft=33,Es=g.createContext(0);function cc(){const t=g.useMemo(()=>[["char","Character",r(dc,{},"char")],["discCond","Disc Conditionals",r(Nr,{},"discCond")],["wengineCond","Wengine Conditionals",r(ac,{},"wengineCond")],["opt","Optimize",r(uc,{},"opt")]],[]);return r(Es.Provider,{value:t.length,children:r(B,{gap:1,children:t.map(([e,n,s],i)=>r(lc,{title:n,index:i,children:s},e))})})}function lc({index:t,title:e,children:n}){const[s,i]=io(),a=g.useContext(Es),o=g.useContext(Ss);return x(Vn,{children:[r($,{sx:c=>({outline:`solid ${c.palette.secondary.main}`,position:"sticky",top:o+t*ft,bottom:rc+(a-1-t)*ft,zIndex:100}),children:r(Wi,{onClick:i,sx:{px:1},children:r(S,{variant:"h6",children:e})})}),r(_,{ref:s,sx:{scrollMarginTop:o+(t+1)*ft},children:n})]})}function dc(){const t=oe(),{key:e}=t,[n,s]=g.useState(void 0);return x(B,{spacing:1,children:[x(_,{sx:{display:"flex",gap:1,backgroundColor:"#1b263b"},children:[x(_,{sx:{margin:"24px 0 16px 24px"},children:[r(_,{sx:{border:"4px rgb(46, 54, 70) solid",borderRadius:"20px",overflow:"hidden"},children:r(Ji,{character:t})}),r(Xi,{characterKey:n,onClose:()=>s(void 0)}),r(Q,{fullWidth:!0,disabled:!e,onClick:()=>e&&s(e),children:"Edit Character"})]}),r(pc,{})]}),r(Tr,{}),r(ma,{formulasRead:Z.listing.formulas,buffsRead:Z.listing.buffs})]})}function uc(){return r(sc,{})}function pc(){const{database:t}=E(),e=oe(),{key:n,equippedDiscs:s,equippedWengine:i}=e;return r($,{sx:{width:"100%"},children:r(T,{children:r(Zi,{setDisc:(a,o)=>o?t.discs.set(o,{location:n}):t.discs.set(s[a],{location:""}),setWengine:a=>a?t.wengines.set(a,{location:n}):t.wengines.set(i,{location:""})})})})}function fc({character:t,charOpt:e,children:n}){const s=hc(t),i=g.useMemo(()=>la([...ca([t.key]),...s,be.common.lvl.add(80),be.common.def.add(953),be.common.isStunned.add(0),be.common.stun_.add(1.5),be.common.unstun_.add(1),mt.common.critMode.add("avg"),...e.conditionals.flatMap(({sheet:a,src:o,dst:c,condKey:d,condValue:l})=>Jt("preset0",Ai(a,o,c)(d,l))),...e.bonusStats.flatMap(({tag:a,value:o})=>Jt("preset0",{tag:{...a},value:ee(Ni(o,a.q??""))}))]),[s,e,t.key]);return r(_e.Provider,{value:i,children:n})}function hc(t){const e=ji(t==null?void 0:t.equippedWengine),n=Un(t==null?void 0:t.equippedDiscs),s=g.useMemo(()=>e?aa(e.key,e.level,e.modification,e.phase):[],[e]),i=g.useMemo(()=>n?mc(Object.values(n).filter(Jn)):[],[n]);return g.useMemo(()=>t?ia(t.key,...oa(t),...s,...i):[],[t,s,i])}function mc(t){const e={},n={};return t.forEach(({setKey:s,mainStatKey:i,substats:a,level:o,rarity:c})=>{e[s]=(e[s]??0)+1,n[i]=(n[i]??0)+es(c,i,o),a.forEach(({key:d,upgrades:l})=>{!d||!l||(n[d]=(n[d]??0)+ts(d,c)*l)})}),ra(n,e)}function gc({character:{key:t},charOpt:{target:e}}){const{database:n}=E();return r(Tt,{optTarget:e,setOptTarget:s=>n.charOpts.set(t,{target:s}),buttonProps:{fullWidth:!0,sx:{height:"100%"}}})}function Mc(){const{database:t}=E(),[e,n]=g.useState(qi[0]),{t:s}=re(["charNames_gen","page_character"]),i=Ui(e);g.useEffect(()=>{e&&!i&&t.chars.getOrCreate(e)},[e,i,t.chars]);const a=me(e);g.useEffect(()=>{e&&!a&&t.charOpts.getOrCreate(e)},[e,a,t.charOpts]),zo(g.useMemo(()=>{const p=e&&s(`charNames_gen:${e}`);return p?`Optimize - ${p}`:"Optimize"},[e,s]));const o=g.useMemo(()=>{const m=Be(e?[e]:[],f=>r(Qi,{characterKey:f}));return{srcDisplay:m,dstDisplay:m}},[e]),c=g.useCallback((p,m,f,b,C)=>{!Pi(p)||!Bt(f)||!(b===null||Bt(b))||!Li(p,m)||t.charOpts.setConditional(e,p,m,f,b,C)},[e,t.charOpts]),d=g.useMemo(()=>({src:e,dst:e,preset:"preset0"}),[e]),[l,u]=g.useState(),h=g.useMemo(()=>({read:l,setRead:u}),[l]);return x(_,{children:[r(Ki,{locKey:e,setLocKey:p=>p&&n(p)}),i&&a&&r(Gi.Provider,{value:i,children:r(ve.Provider,{value:d,children:r(fc,{character:i,charOpt:a,children:r(Fi.Provider,{value:o,children:r(Bi.Provider,{value:a.conditionals,children:r(Hi.Provider,{value:c,children:x(Kn.Provider,{value:h,children:[r(ga,{}),x(_,{sx:{display:"flex",gap:1,flexDirection:"column",mt:2},children:[r(gc,{character:i,charOpt:a}),r(Ss.Provider,{value:0,children:r(cc,{})})]})]})})})})})})})]})}export{Mc as default};
