import{e as A,u as M,r as l,cF as ne,j as e,a as c,G as d,T as j,B as _,d as te,b as F,k as $,W as N,$ as L,cG as P,bN as se,cH as ie,ce as le,cc as ae,cI as oe,cJ as ce,cd as R,cK as re,cL as de,b$ as ue,cM as ge,c as U,C as H,ab as pe,bL as G,cN as he,bM as ye,cO as fe,f as me,cP as we,g as Te,cQ as We,h as xe,i as ke,p as be,cw as Se,bt as Ce,cR as O,cS as Ie,cT as qe,cU as ve,cy as Ee,S as Ke}from"./index-yBxn32Fv.js";import{u as Q}from"./useDataEntryBase-DEmlLOxx.js";const V=["locked","unlocked"],De=pe([...V]);function Fe({numShowing:m,total:t,wengineIds:W}){const{t:r}=A(["page_wengine","ui"]),{database:a}=M(),x=Q(a.displayWengine),{speciality:k,rarity:b,locked:S,showEquipped:u,showInventory:y,locations:B}=x,{lockedTotal:w,equippedTotal:f,locationTotal:C,wengineTotals:I,wengineRarityTotals:q}=l.useMemo(()=>{const i={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...he,""],wengineTotals:[...ye],wengineRarityTotals:[...fe]};return ne(i,s=>a.wengines.entries.forEach(([v,o])=>{const g=o.location,E=o.lock?"locked":"unlocked",T=g?"equipped":"unequipped",K=G(o.key).type,p=G(o.key).rarity;s.lockedTotal[E].total++,s.equippedTotal[T].total++,s.locationTotal[g].total++,s.wengineTotals[K].total++,p&&s.wengineRarityTotals[p].total++,W.includes(v)&&(s.lockedTotal[E].current++,s.equippedTotal[T].current++,s.locationTotal[g].current++,s.wengineTotals[K].current++,p&&s.wengineRarityTotals[p].current++)}))},[a.wengines.entries,W]);return e(H,{children:c(U,{sx:{display:"flex",flexDirection:"column",gap:1},children:[c(d,{container:!0,children:[e(d,{item:!0,children:e(j,{variant:"h6",children:r("wengineFilterTitle")})}),e(d,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:c(j,{children:[e("strong",{children:m})," / ",t]})}),e(d,{item:!0,children:e(_,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(te,{}),children:e(F,{t:r,i18nKey:"ui:reset"})})})]}),e($,{children:c(d,{container:!0,spacing:1,children:[c(d,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(F,{t:r,i18nKey:"subheadings.general"}),c(N,{spacing:1,children:[e(L,{sx:{bgcolor:P.palette.contentNormal.light}}),e(se,{fullWidth:!0,onChange:i=>a.displayWengine.set({speciality:i}),value:k,totals:I,size:"small"}),e(ie,{sx:{height:"100%"},fullWidth:!0,onChange:i=>a.displayWengine.set({rarity:i}),value:b,totals:q,size:"small"})]})]}),e(d,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:c($,{children:[e(F,{t:r,i18nKey:"subheadings.inventory"}),c(N,{spacing:1,children:[e(L,{sx:{bgcolor:P.palette.contentNormal.light}}),e(le,{fullWidth:!0,value:S,size:"small",children:V.map((i,s)=>c(ae,{value:i,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:De(S,i)}),children:[s?e(oe,{}):e(ce,{}),e(F,{t:r,i18nKey:`ui:${i}`}),e(R,{label:w[s?"unlocked":"locked"],size:"small"})]},i))}),c(_,{startIcon:e(re,{}),color:y?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!y}),children:[r("wengineInInv")," ",e(R,{sx:{ml:1},label:f.unequipped,size:"small"})]}),c(_,{startIcon:e(de,{}),color:u?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!u}),children:[r("equippedWengine")," ",e(R,{sx:{ml:1},label:f.equipped,size:"small"})]})]}),e(N,{spacing:1.5,pt:1.5,children:e(l.Suspense,{fallback:null,children:e(ue,{title:u?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(ge,{totals:C,locations:u?[]:B,setLocations:i=>a.displayWengine.set({locations:i}),disabled:u})})})})})]})})]})})]})})}const _e={xs:2,sm:3,md:4,lg:4,xl:6},$e={xs:10,sm:12,md:24,lg:24,xl:24},Be=Object.keys(O);function Re(){const{t:m}=A(["page_wengine","ui"]),{database:t}=M(),[W,r]=l.useState(!1),a=Q(t.displayWengine),[x,k]=me();l.useEffect(()=>t.wengines.followAny((n,h)=>(h==="new"||h==="remove"||h==="update")&&k()),[k,t]);const[b,S]=l.useState(""),u=l.useDeferredValue(b),y=l.useCallback(n=>{t.displayWengine.set({editWengineId:n})},[t]),B=l.useCallback(n=>{y(t.wengines.new(we(n)))},[t.wengines,y]),{sortType:w,ascending:f,speciality:C,rarity:I,locked:q,showEquipped:i,showInventory:s,locations:v}=a,{wengineIds:o,totalWengineNum:g}=l.useMemo(()=>{const n=t.wengines.values,h=n.length,Z=n.filter(Te({speciality:C,rarity:I,name:u,locked:q,showInventory:s,showEquipped:i,locations:v},Ie())).sort(We(O[w]??[],f,qe())).map(ee=>ee.id);return x&&{wengineIds:Z,totalWengineNum:h}},[t.wengines.values,C,I,u,q,s,i,v,w,f,x]),E=xe(),{numShow:T,setTriggerElement:K}=ke($e[E],o.length),p=l.useMemo(()=>o.slice(0,T),[o,T]),z=l.useCallback(()=>t.displayWengine.set({editWengineId:""}),[t]),{editWengineId:D}=a;l.useEffect(()=>{D&&(t.wengines.get(D)||z())},[t,D,z]);const J=o.length!==g?`${o.length}/${g}`:`${g}`,X={numShowing:p.length,total:J,t:m,namespace:"page_wengine"},Y={sortKeys:[...Be],value:w,onChange:n=>t.displayWengine.set({sortType:n}),ascending:f,onChangeAsc:n=>t.displayWengine.set({ascending:n})};return c($,{display:"flex",flexDirection:"column",gap:1,children:[e(l.Suspense,{fallback:!1,children:e(ve,{show:W,onHide:()=>r(!1),onSelect:B})}),e(l.Suspense,{fallback:!1,children:e(Ee,{wengineId:D,footer:!0,onClose:z})}),e(Fe,{numShowing:o.length,total:g,wengineIds:o}),e(H,{children:e(U,{sx:{display:"flex",flexDirection:"column",gap:1},children:c($,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(be,{autoFocus:!0,size:"small",value:b,onChange:n=>S(n.target.value),label:m("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Se,{showingTextProps:X,sortByButtonProps:Y})]})})}),e(_,{fullWidth:!0,onClick:()=>r(!0),color:"info",children:m("page_wengine:addWengine")}),e(d,{container:!0,spacing:1,columns:_e,children:p.map(n=>e(d,{item:!0,xs:1,children:e(Ce,{wengineId:n,onEdit:y,setLocation:h=>t.wengines.set(n,{location:h})})},n))}),o.length!==p.length&&e(Ke,{ref:n=>{n&&K(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Re as default};
