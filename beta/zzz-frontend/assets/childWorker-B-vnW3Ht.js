(function(){"use strict";const v=(e,n,t)=>e<n?n:e>t?t:e,w=e=>v(e,0,1);function k(e,n){return Object.fromEntries(e.map((t,a)=>[t,n(t,a)]))}function h(e,n){return n===1||Object.keys(e).forEach(t=>{typeof e[t]=="object"&&h(e[t],n),typeof e[t]=="number"&&(e[t]=e[t]*n)}),e}function s(e,n){for(const t in n)e[t]=(e[t]??0)+n[t];return e}const S=["hp","atk","def","hp_","atk_","def_","pen","crit_","crit_dmg_","anomProf"],y=["hp","atk","def","hp_","atk_","def_","crit_","crit_dmg_","anomProf",...["electric_dmg_","fire_dmg_","ice_dmg_","physical_dmg_","ether_dmg_"],"pen_","anomMas_","impact_","enerRegen_"];Array.from(new Set([...S,...y]));const b={AstralVoice:{atk_:.1},BranchBladeSong:{crit_dmg_:.16},ChaosJazz:{anomProf:30},ChaoticMetal:{ether_dmg_:.1},FangedMetal:{physical_dmg_:.1},FreedomBlues:{anomProf:30},HormonePunk:{atk_:.1},InfernoMetal:{fire_dmg_:.1},PolarMetal:{ice_dmg_:.1},ProtoPunk:{shield_:.15},PufferElectro:{pen_:.08},ShockstarDisco:{impact_:.06},SoulRock:{def_:.16},SwingJazz:{enerRegen_:.2},ThunderMetal:{electric_dmg_:.1},WoodpeckerElectro:{crit_:.08}},m={AstralVoice:{key:"AstralVoice",text:e=>`${e} Stacks of Astral`,min:1,max:3},BranchBladeSong:{key:"BranchBladeSong",text:"When any squad member applies Freeze or triggers the Shatter effect on an enemy",min:1,max:1},ChaosJazz:{key:"ChaosJazz",text:"When off-field",min:1,max:1},ChaoticMetal:{key:"ChaoticMetal",text:e=>`${e}x Corruption Triggers`,min:1,max:6},FangedMetal:{key:"FangedMetal",text:"Whenever a squad member inflicts Assault on an enemy",min:1,max:1},HormonePunk:{key:"HormonePunk",text:"Upon entering or switching into combat",min:1,max:1},InfernoMetal:{key:"InfernoMetal",text:"Upon hitting a Burning enemy",min:1,max:1},PolarMetalBasicOrDash:{key:"PolarMetalBasicOrDash",text:"Optimizing for Basic Attack or Dash Attack",min:1,max:1},PolarMetal:{key:"PolarMetal",text:"Whenever a squad member Freezes or Shatters an enemy",min:1,max:1},ProtoPunk:{key:"ProtoPunk",text:"When any squad member triggers a Defensive Assist or Evasive Assist",min:1,max:1},PufferElectroUltimate:{key:"PufferElectroUltimate",text:"Optimizing for Ultimate Damage",min:1,max:1},PufferElectro:{key:"PufferElectro",text:"Launching an Ultimate",min:1,max:1},SwingJazz:{key:"SwingJazz",text:"Launching a Chain Attack or Ultimate",min:1,max:1},ThunderMetal:{key:"ThunderMetal",text:"As long as an enemy in combat is Shocked",min:1,max:1},WoodpeckerElectro:{key:"WoodpeckerElectro",text:e=>`${e}x Triggering a critical hit with a Basic Attack, Dodge Counter, or EX Special Attack`,min:1,max:3}},F={AstralVoice:{condMeta:m.AstralVoice,getStats:e=>e.AstralVoice?h({dmg_:.08},e.AstralVoice):void 0},BranchBladeSong:{condMeta:m.BranchBladeSong,getStats:(e,n)=>{const t={};return((n.anomMas_base??0)*(1+(n.anomMas_??0))+(n.anomMas??0))*(1+(n.cond_anomMas_??0))+(n.cond_anomMas??0)>=115&&(t.crit_dmg_=.3),e.BranchBladeSong&&(t.crit_=.12),t}},ChaosJazz:{condMeta:m.ChaosJazz,getStats:e=>{const n={fire_dmg_:.15,electric_dmg_:.15};return e.ChaosJazz&&(n.dmg_=.2),n}},ChaoticMetal:{condMeta:m.ChaoticMetal,getStats:e=>{const n={crit_dmg_:.2};return e.ChaoticMetal&&s(n,h({crit_dmg_:.055},e.ChaoticMetal)),n}},FangedMetal:{condMeta:m.FangedMetal,getStats:e=>{if(e.FangedMetal)return{dmg_:.35}}},HormonePunk:{condMeta:m.HormonePunk,getStats:e=>{if(e.HormonePunk)return{cond_atk_:.25}}},InfernoMetal:{condMeta:m.InfernoMetal,getStats:e=>{if(e.InfernoMetal)return{crit_:.28}}},PolarMetal:{condMeta:[m.PolarMetalBasicOrDash,m.PolarMetal],getStats:e=>{if(!e.PolarMetalBasicOrDash)return{};const n={dmg_:.2};return e.PolarMetal&&h(n,2),n}},ProtoPunk:{condMeta:m.ProtoPunk,getStats:e=>{if(e.ProtoPunk)return{dmg_:.15}}},PufferElectro:{condMeta:[m.PufferElectroUltimate,m.PufferElectro],getStats:e=>{const n={};return e.PufferElectroUltimate&&(n.dmg_=.2),e.PufferElectro&&(n.cond_atk_=.15),n}},SwingJazz:{condMeta:m.SwingJazz,getStats:e=>{if(e.SwingJazz)return{dmg_:.15}}},ThunderMetal:{condMeta:m.ThunderMetal,getStats:e=>{if(e.ThunderMetal)return{cond_atk_:.27}}},WoodpeckerElectro:{condMeta:m.WoodpeckerElectro,getStats:e=>{if(e.WoodpeckerElectro)return h({cond_atk_:.09},e.WoodpeckerElectro)}}},z=["charLvl","enemyDef","enemyDefRed_","enemyRes_","enemyResRed_","enemyResIgn_","common_dmg_","dmg_","impact","anomMas","shield_","enerRegen"];Array.from(new Set([...y,...S,...z]));const H=["impact","anomMas","dmg_","shield_"];Array.from(new Set([...y,...S,...H]));const W=["electric_dmg_","fire_dmg_","ice_dmg_","physical_dmg_","ether_dmg_"],M=["burn","shock","corruption","shatter","assault"];({...k(M,e=>`${e} DMG Bonus`)},Object.entries({electric:"Electric",fire:"Fire",ice:"Ice",physical:"Physical",ether:"Ether"}).forEach(([e,n])=>{}));const L=["BashfulDemon","BigCylinder","BlazingLaurel","BunnyBand","CannonRotor","DeepSeaVisitor","DemaraBatteryMarkII","DrillRigRedAxis","ElectroLipGloss","ElegantVanity","FlamemakerShaker","FusionCompiler","GildedBlossom","HailstormShrine","HeartstringNocturne","HellfireGears","Housekeeper","IceJadeTeapot","IdentityBase","IdentityInflection","KaboomTheCannon","LunarDecrescent","LunarNoviluna","LunarPleniluna","MagneticStormAlpha","MagneticStormBravo","MagneticStormCharlie","MarcatoDesire","OriginalTransmorpher","PeacekeeperSpecialized","PreciousFossilizedCore","RainforestGourmet","ReverbMarkI","ReverbMarkII","ReverbMarkIII","RiotSuppressorMarkVI","RoaringRide","SharpenedStinger","SixShooter","SliceOfTime","SpringEmbrace","StarlightEngine","StarlightEngineReplica","SteamOven","SteelCushion","StreetSuperstar","TheBrimstone","TheRestrained","TheVault","Timeweaver","TusksOfFury","UnfetteredGameBall","VortexArrow","VortexHatchet","VortexRevolver","WeepingCradle","WeepingGemini","ZanshinHerbCase"],o={BashfulDemon:{key:"BashfulDemon",text:e=>`${e}x Launching an EX Special Attack`,min:1,max:4},BlazingLaurelImpact:{key:"BlazingLaurelImpact",text:"Upon launching a Quick Assist or Perfect Assist",min:1,max:1},BlazingLaurelCritDmg:{key:"BlazingLaurelCritDmg",text:e=>`${e}x Wilt`,min:1,max:20},BunnyBand:{key:"BunnyBand",text:"Shielded",min:1,max:1},DeepSeaVisitorBasic:{key:"DeepSeaVisitorBasic",text:"hitting an enemy with a Basic Attack",min:1,max:1},DeepSeaVisitorDash:{key:"DeepSeaVisitorDash",text:"hitting an enemy with a Dash Attack",min:1,max:1},DrillRigRedAxis:{key:"DrillRigRedAxis",text:"When launching an EX Special Attack or Chain Attack",min:1,max:1},ElectroLipGloss:{key:"ElectroLipGloss",text:"enemies inflicted with Attribute Anomaly",min:1,max:1},ElegantVanity:{key:"ElegantVanity",text:e=>`${e}x When the equipper consumes 25 or more Energy`,min:1,max:2},FlamemakerShakerOffField:{key:"FlamemakerShakerOffField",text:"When off-field",min:1,max:1},FlamemakerShakerStack:{key:"FlamemakerShakerStack",text:e=>`${e}x Stacks of hitting an enemy with an EX Special Attack or Assist Attack`,min:1,max:10},FusionCompiler:{key:"FusionCompiler",text:e=>`${e}x Special Attack or EX Special Attack`,min:1,max:3},HailstormShrine:{key:"HailstormShrine",text:e=>`${e}x Using an EX Special Attack or when any squad member applies an Attribute Anomaly to an enemy`,min:1,max:2},HeartstringNocturne:{key:"HeartstringNocturne",text:e=>`${e}x Stacks of Heartstring`,min:1,max:2},Housekeeper:{key:"Housekeeper",text:e=>`${e}x When an EX Special Attack hits an enemy`,min:1,max:15},IceJadeTeapot:{key:"IceJadeTeapot",text:e=>`${e}x Tea-riffic`,min:1,max:30},IdentityBase:{key:"IdentityBase",text:"When attacked",min:1,max:1},KaboomTheCannon:{key:"KaboomTheCannon",text:e=>`${e}x When any friendly unit in the squad attacks and hits an enemy`,min:1,max:4},LunarDecrescent:{key:"LunarDecrescent",text:"Launching a Chain Attack or Ultimate",min:1,max:1},MagneticStormAlpha:{key:"MagneticStormAlpha",text:"Accumulating Anomaly Buildup",min:1,max:1},MagneticStormBravo:{key:"MagneticStormBravo",text:"Accumulating Anomaly Buildup",min:1,max:1},MarcatoDesireHit:{key:"MarcatoDesireHit",text:"When an EX Special Attack or Chain Attack hits an enemy",min:1,max:1},MarcatoDesireAnomaly:{key:"MarcatoDesireAnomaly",text:"While the target is under an Attribute Anomaly",min:1,max:1},OriginalTransmorpher:{key:"OriginalTransmorpher",text:"When attacked",min:1,max:1},RainforestGourmet:{key:"RainforestGourmet",text:e=>`${e}x Stacks`,min:1,max:10},ReverbMarkII:{key:"ReverbMarkII",text:"Launching an EX Special Attack or Chain Attack",min:1,max:1},ReverbMarkIII:{key:"ReverbMarkIII",text:"Launching a Chain Attack or Ultimate",min:1,max:1},RiotSuppressorMarkVI:{key:"RiotSuppressorMarkVI",text:"consumes a Charge stack",min:1,max:1},RoaringRideATK:{key:"RoaringRideATK",text:"Increases the equipper's ATK",min:1,max:1},RoaringRideAnomProf:{key:"RoaringRideAnomProf",text:"increases the equipper's Anomaly Proficiency",min:1,max:1},RoaringRideAnomBuild_:{key:"RoaringRideAnomBuild_",text:"increases the equipper's Anomaly Buildup Rate",min:1,max:1},SharpenedStinger:{key:"SharpenedStinger",text:e=>`${e}x Predatory Instinct`,min:1,max:3},StarlightEngine:{key:"StarlightEngine",text:"Launching a Dodge Counter or Quick Assist",min:1,max:1},StarlightEngineReplica:{key:"StarlightEngineReplica",text:"hitting an enemy at least 6 meters away with a Basic Attack or Dash Attack",min:1,max:1},SteamOven:{key:"SteamOven",text:e=>`${e*10} Energy accumulated`,min:1,max:8},SteelCushion:{key:"SteelCushion",text:"when hitting the enemy from behind",min:1,max:1},StreetSuperstar:{key:"StreetSuperstar",text:e=>`${e} Charge stacks`,min:1,max:3},TheBrimstone:{key:"TheBrimstone",text:e=>`${e}x Upon hitting an enemy with a Basic Attack, Dash Attack, or Dodge Counter`,min:1,max:8},TheRestrained:{key:"TheRestrained",text:e=>`${e}x When an attack hits an enemy, DMG and Daze from Basic Attacks`,min:1,max:5},TheVault:{key:"TheVault",text:"Dealing Ether DMG using an EX Special Attack, Chain Attack, or Ultimate",min:1,max:1},Timeweaver:{key:"Timeweaver",text:"When Special Attacks or EX Special Attacks hit enemies suffering an Attribute Anomaly",min:1,max:1},TusksOfFury:{key:"TusksOfFury",text:"When any squad member triggers Interrupt or Perfect Dodge",min:1,max:1},UnfetteredGameBall:{key:"UnfetteredGameBall",text:"Whenever the equipper's attack triggers an Attribute Counter effect",min:1,max:1},WeepingCradle:{key:"WeepingCradle",text:e=>`${e}x Attacks from the equipper`,min:1,max:6},WeepingGemini:{key:"WeepingGemini",text:e=>`${e}x Whenever a squad member inflicts an Attribute Anomaly on an enemy`,min:1,max:4},ZanshinHerbCase:{key:"ZanshinHerbCase",text:"When any squad member applies an Attribute Anomaly or Stuns an enemy",min:1,max:1}},V={BashfulDemon:{condMeta:o.BashfulDemon,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.15,.175,.2,.22,.24],r=[.02,.023,.026,.029,.032],i={ice_dmg_:a[t]};return e.BashfulDemon&&s(i,{cond_atk_:r[t]*e.BashfulDemon}),i}},BlazingLaurel:{condMeta:[o.BlazingLaurelImpact,o.BlazingLaurelCritDmg],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.25,.2875,.325,.3625,.4],r=[.015,.0172,.0195,.0217,.024],i={};return e.BlazingLaurelImpact&&s(i,{impact_:a[t]}),e.BlazingLaurelCritDmg&&s(i,{crit_dmg_:r[t]*e.BlazingLaurelCritDmg}),i}},BunnyBand:{condMeta:o.BunnyBand,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.08,.092,.104,.116,.128],r=[.1,.115,.13,.145,.16],i={cond_hp_:a[t]};return e.BunnyBand&&s(i,{cond_atk_:r[t]}),i}},CannonRotor:{condMeta:[],getStats:(e,n)=>{const t=n.wenginePhase-1;return{cond_atk_:[.075,.086,.097,.108,.12][t]}}},DeepSeaVisitor:{condMeta:[o.DeepSeaVisitorBasic,o.DeepSeaVisitorDash],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.25,.315,.38,.445,.5],r=[.1,.125,.15,.175,.2],i={ice_dmg_:a[t]};return e.DeepSeaVisitorBasic&&s(i,{crit_:r[t]}),e.DeepSeaVisitorDash&&s(i,{crit_:r[t]}),i}},DemaraBatteryMarkII:{condMeta:[],getStats:(e,n)=>{const t=n.wenginePhase-1;return{electric_dmg_:[.15,.175,.2,.22,.24][t]}}},DrillRigRedAxis:{condMeta:o.DrillRigRedAxis,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.5,.575,.65,.725,.8],r={};return e.DrillRigRedAxis&&s(r,{electric_dmg_:a[t]}),r}},ElectroLipGloss:{condMeta:o.ElectroLipGloss,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.1,.115,.13,.145,.16],r=[.15,.175,.2,.225,.25],i={};return e.ElectroLipGloss&&s(i,{cond_atk_:a[t],dmg_:r[t]}),i}},ElegantVanity:{condMeta:o.ElegantVanity,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.1,.115,.13,.145,.16],r={};return e.ElegantVanity&&s(r,{dmg_:a[t]*e.ElegantVanity}),r}},FlamemakerShaker:{condMeta:[o.FlamemakerShakerOffField,o.FlamemakerShakerStack],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.035,.044,.052,.061,.07],r=[50,62,75,87,100];if(e.FlamemakerShakerStack){const i={dmg_:a[t]*e.FlamemakerShakerStack};return e.FlamemakerShakerStack>=5&&s(i,{cond_anomProf:r[t]}),i}}},FusionCompiler:{condMeta:o.FusionCompiler,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.12,.15,.18,.21,.24],r=[25,31,37,43,50],i={cond_atk_:a[t]};return e.FusionCompiler&&s(i,{cond_anomProf:r[t]*e.FusionCompiler}),i}},GildedBlossom:{condMeta:[],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.06,.069,.078,.087,.096],r=[.15,.172,.195,.218,.24];return{cond_atk_:a[t],dmg_:r[t]}}},HailstormShrine:{condMeta:o.HailstormShrine,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.5,.57,.65,.72,.8],r=[.2,.23,.26,.29,.32],i={crit_dmg_:a[t]};return e.HailstormShrine&&s(i,{ice_dmg_:r[t]*e.HailstormShrine}),i}},HeartstringNocturne:{condMeta:o.HeartstringNocturne,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.125,.145,.165,.185,.2],i={crit_dmg_:[.5,.575,.65,.725,.8][t]};return e.HeartstringNocturne&&s(i,{enemyResIgn_:a[t]*e.HeartstringNocturne}),i}},Housekeeper:{condMeta:o.Housekeeper,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.03,.035,.04,.044,.048],r={};return e.Housekeeper&&s(r,{physical_dmg_:a[t]*e.Housekeeper}),r}},IceJadeTeapot:{condMeta:o.IceJadeTeapot,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.07,.088,.0105,.0122,.014],r=[.2,.23,.26,.29,.32],i={};return e.IceJadeTeapot&&s(i,{impact_:a[t]*e.IceJadeTeapot}),(e.IceJadeTeapot??0)>=15&&s(i,{dmg_:r[t]}),i}},IdentityBase:{condMeta:o.IdentityBase,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.2,.23,.26,.29,.32];if(e.IdentityBase)return{cond_def_:a[t]}}},KaboomTheCannon:{condMeta:o.KaboomTheCannon,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.025,.028,.032,.036,.04];if(e.KaboomTheCannon)return{cond_atk_:a[t]*e.KaboomTheCannon}}},LunarDecrescent:{condMeta:o.LunarDecrescent,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.15,.175,.2,.225,.25];if(e.LunarDecrescent)return{dmg_:a[t]*e.LunarDecrescent}}},LunarPleniluna:{condMeta:[],getStats:(e,n)=>{const t=n.wenginePhase-1;return{dmg_:[.12,.14,.16,.18,.2][t]}}},MagneticStormAlpha:{condMeta:o.MagneticStormAlpha,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[25,28,32,36,40];if(e.MagneticStormAlpha)return{cond_anomMas:a[t]}}},MagneticStormBravo:{condMeta:o.MagneticStormBravo,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[25,28,32,36,40];if(e.MagneticStormBravo)return{anomProf:a[t]}}},MarcatoDesire:{condMeta:[o.MarcatoDesireHit,o.MarcatoDesireAnomaly],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.06,.07,.08,.09,.1];if(e.MarcatoDesireHit||e.MarcatoDesireAnomaly)return{cond_atk_:a[t]*((e.MarcatoDesireHit??0)+(e.MarcatoDesireAnomaly??0))}}},OriginalTransmorpher:{condMeta:o.OriginalTransmorpher,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.08,.09,.1,.11,.125],r=[.1,.115,.13,.145,.16],i={cond_hp_:a[t]};return e.OriginalTransmorpher&&s(i,{impact_:r[t]}),i}},RainforestGourmet:{condMeta:o.RainforestGourmet,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.025,.028,.032,.036,.04];if(e.RainforestGourmet)return{cond_atk_:a[t]*e.RainforestGourmet}}},ReverbMarkII:{condMeta:o.ReverbMarkII,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[10,12,13,15,16];if(e.ReverbMarkII)return{cond_anomMas:a[t],anomProf:a[t]}}},ReverbMarkIII:{condMeta:o.ReverbMarkIII,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.08,.09,.1,.11,.12];if(e.ReverbMarkIII)return{cond_atk_:a[t]}}},RiotSuppressorMarkVI:{condMeta:o.RiotSuppressorMarkVI,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.15,.188,.226,.264,.3],r=[.35,.435,.52,.605,.7],i={crit_:a[t]};return e.RiotSuppressorMarkVI&&s(i,{dmg_:r[t]}),i}},RoaringRide:{condMeta:[o.RoaringRideATK,o.RoaringRideAnomProf,o.RoaringRideAnomBuild_],getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.08,.092,.104,.116,.128],r=[40,46,52,58,64],i=[.25,.28,.32,.36,.4],c={};return e.RoaringRideATK&&s(c,{cond_atk_:a[t]}),e.RoaringRideAnomProf&&s(c,{cond_anomProf:r[t]}),e.RoaringRideAnomBuild_&&s(c,{anomBuild_:i[t]}),c}},SharpenedStinger:{condMeta:o.SharpenedStinger,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.12,.15,.18,.21,.24],r=[.4,.5,.6,.7,.8];if(e.SharpenedStinger)return e.SharpenedStinger<3?{physical_dmg_:a[t]*e.SharpenedStinger}:{physical_dmg_:a[t]*e.SharpenedStinger,anomBuild_:r[t]}}},StarlightEngine:{condMeta:o.StarlightEngine,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.12,.138,.156,.174,.192];if(e.StarlightEngine)return{cond_atk_:a[t]}}},StarlightEngineReplica:{condMeta:o.StarlightEngineReplica,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.36,.41,.465,.52,.575];if(e.StarlightEngineReplica)return{physical_dmg_:a[t]}}},SteamOven:{condMeta:o.SteamOven,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.02,.023,.026,.029,.032];if(e.SteamOven)return{impact_:a[t]*e.SteamOven}}},SteelCushion:{condMeta:o.SteelCushion,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.2,.25,.3,.35,.4],r=[.25,.315,.38,.44,.5],i={physical_dmg_:a[t]};return e.SteelCushion&&s(i,{dmg_:r[t]}),i}},StreetSuperstar:{condMeta:o.StreetSuperstar,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.15,.172,.195,.217,.24];if(e.StreetSuperstar)return{dmg_:a[t]}}},TheBrimstone:{condMeta:o.TheBrimstone,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.035,.044,.052,.06,.07];if(e.TheBrimstone)return{cond_atk_:a[t]*e.TheBrimstone}}},TheRestrained:{condMeta:o.TheRestrained,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.06,.075,.09,.105,.12];if(e.TheRestrained)return{dmg_:a[t]*e.TheRestrained,daze_:a[t]*e.TheRestrained}}},TheVault:{condMeta:o.TheVault,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.15,.175,.2,.22,.24];if(e.TheVault)return{dmg_:a[t]}}},Timeweaver:{condMeta:o.Timeweaver,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[75,85,95,105,115],r=[.25,.275,.3,.325,.35],i={};return e.Timeweaver&&s(i,{cond_anomProf:a[t]}),(n.anomProf??0)>=375&&s(i,{dmg_:r[t]}),i}},TusksOfFury:{condMeta:o.TusksOfFury,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.3,.38,.46,.52,.6],r=[.18,.225,.27,.315,.36],i=[.12,.15,.18,.21,.24],c={shield_:a[t]};return e.TusksOfFury&&s(c,{dmg_:r[t],daze_:i[t]}),c}},UnfetteredGameBall:{condMeta:o.UnfetteredGameBall,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.12,.135,.155,.175,.2];if(e.UnfetteredGameBall)return{crit_:a[t]}}},WeepingCradle:{condMeta:o.WeepingCradle,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.1,.125,.15,.175,.2],r=[.017,.02,.025,.03,.033];if(e.WeepingCradle)return{dmg_:a[t]+r[t]*e.WeepingCradle}}},WeepingGemini:{condMeta:o.WeepingGemini,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[30,34,38,42,48];if(e.WeepingGemini)return{cond_anomProf:a[t]*e.WeepingGemini}}},ZanshinHerbCase:{condMeta:o.ZanshinHerbCase,getStats:(e,n)=>{const t=n.wenginePhase-1,a=[.1,.115,.13,.145,.16],r=[.4,.46,.58,.174,.64],i={crit_:a[t],electric_dmg_:r[t]};return e.ZanshinHerbCase&&s(i,{crit_:a[t]}),i}}};function G(e,n,t){const a={};if(!t.length&&!n.length)return!0;for(const{setKey:r}of e)a[r]=(a[r]||0)+1;if(t.length){let r=!1;for(const i in a){const c=i;if(a[c]>=4&&t.includes(c)){r=!0;break}}if(!r)return!1}if(n.length)for(const r in a){const i=r,c=a[i];if(c===1||c>=2&&c<4&&!n.includes(i))return!1}return!0}function K(e,n,t){var f,p;const a={...e},r=l=>a[l]||0,i={};for(const{setKey:l}of t)i[l]=(i[l]||0)+1;s(a,i);for(const{stats:l}of t)s(a,l);for(const l in i){const _=l,u=i[_]??0;if(u>=2){const g=b[_];g&&s(a,g)}if(u>=4){const g=(f=F[_])==null?void 0:f.getStats(n,a);g&&s(a,g)}}const c=(p=V[L[r("wengineIndex")]])==null?void 0:p.getStats(n,a);return c&&s(a,c),a.initial_hp=r("hp_base")*(1+r("hp_"))+r("hp"),a.initial_atk=r("atk_base")*(1+r("atk_"))+r("atk"),a.initial_def=r("def_base")*(1+r("def_"))+r("def"),a.final_hp=r("initial_hp")*(1+r("cond_hp_"))+r("cond_hp"),a.final_atk=r("initial_atk")*(1+r("cond_atk_"))+r("cond_atk"),a.final_def=r("initial_def")*(1+r("cond_def_"))+r("cond_def"),a.impact=r("impact")*(1+r("impact_")),a.final_anomMas=(r("anomMas_base")*(1+r("anomMas_"))+r("anomMas"))*(1+r("cond_anomMas_"))+r("cond_anomMas"),a.crit_=w(a.crit_),a}function O(e,n){return U[n](e)??0}const U={initial_atk:e=>e.initial_atk||0,...k(W,e=>n=>{const t=a=>n[a]||0;return t("final_atk")*(1+t(e)+t("dmg_"))*(1+t("crit_")*t("crit_dmg_"))*x(t)*P(t)}),...k(M,e=>n=>{const t=a=>n[a]||0;return X[e]*t("final_atk")*(t("anomProf")*.01)*(1+1/59*(t("charLvl")-1))*(1+t(q[e])+t("dmg_"))*x(t)*P(t)})};function x(e){const n=$(e("charLvl"));return n/(Math.max(e("enemyDef")*(1-e("enemyDefRed_"))*(1-e("pen_"))-e("pen"),0)+n)}function P(e){return 1-e("enemyRes_")+e("enemyResRed_")+e("enemyResIgn_")}function $(e){return J[e]||794}const J={1:50,2:54,3:58,4:62,5:66,6:71,7:76,8:82,9:88,10:94,11:100,12:107,13:114,14:121,15:129,16:137,17:145,18:153,19:162,20:172,21:181,22:191,23:201,24:211,25:222,26:233,27:245,28:256,29:268,30:281,31:293,32:306,33:319,34:333,35:347,36:361,37:375,38:390,39:405,40:421,41:436,42:452,43:469,44:485,45:502,46:519,47:537,48:555,49:573,50:592,51:610,52:629,53:649,54:669,55:689,56:709,57:730,58:751,59:772,60:794},q={burn:"fire_dmg_",shock:"electric_dmg_",corruption:"ether_dmg_",shatter:"ice_dmg_",assault:"physical_dmg_"},X={burn:.5,shock:1.25,corruption:.625,shatter:5,assault:7.13},A=5e4,N=2e5;let d,R,B,D,C,I,E;onmessage=async e=>{try{await Z(e)}catch(n){console.error(n),postMessage({resultType:"err",message:JSON.stringify(n)})}};async function Z(e){const{data:n}=e,{command:t}=n;switch(t){case"init":Q(n);break;case"start":await Y();break}}async function Q({baseStats:e,conditionals:n,discStatsBySlot:t,constraints:a,formulaKey:r,setFilter2:i,setFilter4:c}){B=e,D=n,d=t,R=a,C=r,I=i,E=c,postMessage({resultType:"initialized"})}function*j(){for(const e of d[1])for(const n of d[2])for(const t of d[3])for(const a of d[4])for(const r of d[5])for(const i of d[6])yield{d1:e,d2:n,d3:t,d4:a,d5:r,d6:i}}async function Y(){let e=[],n=0;function t(){const r=e.length;e.length>A&&(e.sort((i,c)=>c.value-i.value),e=e.slice(0,A)),postMessage({resultType:"results",builds:e,numBuildsComputed:r+n}),e=[],n=0}const a=Object.entries(R);for(const{d1:r,d2:i,d3:c,d4:f,d5:p,d6:l}of j()){const _=[r,i,c,f,p,l];if(!G(_,I,E)){n++;continue}const u=K(B,D,_);a.every(([g,{value:T,isMax:ee}])=>ee?u[g]<=T:u[g]>=T)?e.push({value:O(u,C),discIds:{1:r.id,2:i.id,3:c.id,4:f.id,5:p.id,6:l.id}}):n++,e.length+n>N&&t()}e.length+n>0&&t(),postMessage({resultType:"done"})}})();
