import{u as y,r as t,j as e,S as D,C as v,a as d,G as a,T as x,t as k,B as F,d as A,b as G,D as P,c as I,e as U,f as $,g as L,h as V,i as W,k as j,l as _,m as z,F as H,n as K,o as Q}from"./index-yBxn32Fv.js";import{u as R}from"./useDataEntryBase-DEmlLOxx.js";import{d as q}from"./discSortUtil-C2nIE0tj.js";function B(){const{database:r}=y();return R(r.displayDisc)}function J({numShowing:r,total:i,discIds:f}){const s=y().database,{filterOption:c}=B(),l=t.useCallback(u=>s.displayDisc.set({filterOption:{...c,...u}}),[s,c]);return e(t.Suspense,{fallback:e(D,{variant:"rectangular",width:"100%",height:300}),children:e(v,{children:d(I,{children:[d(a,{container:!0,children:[e(a,{item:!0,children:e(x,{variant:"h6",children:k("discFilter")})}),e(a,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:d(x,{children:[e("strong",{children:r})," / ",i]})}),e(a,{item:!0,children:e(F,{size:"small",color:"error",onClick:()=>s.displayDisc.set({action:"reset"}),startIcon:e(A,{}),children:e(G,{t:k,i18nKey:"ui:reset"})})})]}),e(t.Suspense,{fallback:e(D,{variant:"rectangular",width:"100%",height:400}),children:e(P,{filterOption:c,filterOptionDispatch:l,filteredIds:f})})]})})})}const T={xs:2,sm:3,md:4,lg:4,xl:6},X={xs:10,sm:12,md:24,lg:24,xl:24};function Y({onAdd:r,onEdit:i}){const{t:f}=U("disc"),{database:s}=y(),[c,l]=$(),u=t.useDeferredValue(c),w=B(),p=t.useMemo(()=>q(),[]),g=t.useDeferredValue(w);t.useEffect(()=>s.discs.followAny(l),[s,l]);const{discIds:o,totalDiscsNum:m}=t.useMemo(()=>{const{filterOption:n}=g,h=s.discs.values;return{discIds:h.filter(L(n,p)).map(N=>N.id),totalDiscsNum:h.length,...u}},[s.discs.values,u,g,p]),M=V(),O=o.length!==m?`${o.length}/${m}`:m,{numShow:S,setTriggerElement:E}=W(X[M],o.length),b=t.useMemo(()=>o.slice(0,S),[o,S]),C={numShowing:b.length,totalShowing:O};return d(H,{children:[e(J,{numShowing:m,total:m,discIds:o}),e(v,{bgt:"dark",children:e(I,{children:e(j,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:d(x,{color:"text.secondary",children:["Showing ",e("b",{children:C.numShowing})," out of"," ",C.totalShowing," Items"]})})})}),e(a,{container:!0,columns:T,spacing:1,children:e(a,{item:!0,xs:!0,children:e(F,{fullWidth:!0,onClick:r,color:"info",startIcon:e(_,{}),children:f("addNew")})})}),d(t.Suspense,{fallback:e(D,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[e(a,{container:!0,columns:T,spacing:1,children:b.map(n=>e(a,{item:!0,xs:1,children:e(z,{disc:s.discs.get(n),onEdit:()=>i==null?void 0:i(n),onDelete:()=>s.discs.remove(n),setLocation:h=>s.discs.set(n,{location:h}),onLockToggle:()=>s.discs.set(n,({lock:h})=>({lock:!h}))})},n))}),o.length!==b.length&&e(D,{ref:n=>{n&&E(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function ne(){const[r,i]=t.useState({}),[f,s,c]=K(),{database:l}=y(),u=t.useCallback(()=>{i({}),s()},[s]),w=t.useCallback(p=>{const g=l.discs.get(p);g&&(i(g),s())},[l.discs,s]);return d(j,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(Q,{disc:r,allowEmpty:!0,allowUpload:!0,show:f,onClose:c,onShow:s}),e(Y,{onAdd:u,onEdit:w})]})}export{ne as default};
