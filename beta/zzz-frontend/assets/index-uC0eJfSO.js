import{u as I,a as m,r,b as N,c as T,j as w,d as s,C as M,B as k,T as O,e as j,f as B,S as y,F as R}from"./index-BfTjH_YO.js";import{u as A}from"./useBoolState-DR2_Q7G6.js";import{G as p,d as F,D as P,a as U}from"./UploadCard-DBH2XnLR.js";import{u as C}from"./useForceUpdate-DOApKH99.js";function G(){const t=I(),n=m(t.breakpoints.up("sm")),a=m(t.breakpoints.up("md")),e=m(t.breakpoints.up("lg"));return m(t.breakpoints.up("xl"))?"xl":e?"lg":a?"md":n?"sm":"xs"}function L(t){const[n,a]=r.useState(!1),e=r.useRef(null);return!e.current&&typeof window<"u"&&(e.current=new IntersectionObserver(([o])=>a(o.isIntersecting))),r.useEffect(()=>{if(a(!1),!!e.current&&t)return e.current.observe(t),()=>{var o;(o=e.current)==null||o.disconnect()}},[t]),n}function Q(t,n){const[a,e]=r.useState(t),[o,l]=r.useState(),i=L(o),[u,f]=C(),d=i&&a<n;return r.useEffect(()=>{n&&e(t)},[n,t]),r.useEffect(()=>{if(!d)return;u&&e(S=>S+t);const g=setTimeout(()=>f(),1e3);return()=>clearTimeout(g)},[u,d,t,f]),{numShow:a,setTriggerElement:l}}const D={xs:1,sm:2,md:3,lg:3,xl:4},W={xs:10,sm:12,md:24,lg:24,xl:24};function $({onAdd:t,onEdit:n}){const{t:a}=N("disc"),{database:e}=T(),[o,l]=C();r.useEffect(()=>e.discs.followAny(l),[e,l]);const{discIds:i,totalDiscsNum:u}=r.useMemo(()=>{const c=e.discs.values,h=c.length,v=c.map(E=>E.id);return o&&{discIds:v,totalDiscsNum:h}},[e,o]),f=G(),d=i.length!==u?`${i.length}/${u}`:u,{numShow:g,setTriggerElement:S}=Q(W[f],i.length),x=r.useMemo(()=>i.slice(0,g),[i,g]),b={numShowing:x.length,totalShowing:d};return w(R,{children:[s(j,{bgt:"dark",children:s(M,{children:s(k,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:w(O,{color:"text.secondary",children:["Showing ",s("b",{children:b.numShowing})," out of"," ",b.totalShowing," Items"]})})})}),s(p,{container:!0,columns:D,spacing:1,children:s(p,{item:!0,xs:!0,children:s(B,{fullWidth:!0,onClick:t,color:"info",startIcon:s(F,{}),children:a("addNew")})})}),w(r.Suspense,{fallback:s(y,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[s(p,{container:!0,columns:D,spacing:1,children:x.map(c=>s(p,{item:!0,xs:1,children:s(P,{disc:e.discs.get(c),onEdit:()=>n==null?void 0:n(c),onDelete:()=>e.discs.remove(c),setLocation:h=>e.discs.set(c,{location:h}),onLockToggle:()=>e.discs.set(c,({lock:h})=>({lock:!h}))})},c))}),i.length!==x.length&&s(y,{ref:c=>{c&&S(c)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function J(){const[t,n]=r.useState({}),[a,e,o]=A(),{database:l}=T(),i=r.useCallback(()=>{n({}),e()},[e]),u=r.useCallback(f=>{const d=l.discs.get(f);d&&(n(d),e())},[l.discs,e]);return w(k,{display:"flex",flexDirection:"column",gap:1,my:1,children:[s(U,{disc:t,allowEmpty:!0,allowUpload:!0,show:a,onClose:o,onShow:e}),s($,{onAdd:i,onEdit:u})]})}export{J as default};
