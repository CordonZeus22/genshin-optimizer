import{V as S,ah as H,au as x,r,p as l,o as n,z as O,Q as ne,I as se,as as ae,ay as oe,B as m,az as $,T as I,ap as re,m as K,y as N,aA as ie,aB as V,a2 as ce,aC as le,a3 as ue,a6 as G,ai as B,aj as de,ak as pe,al as he,am as me,an as Ce,aT as fe,aJ as ge,aK as W,aL as ye,aM as Se}from"./index-3b67VH4-.js";import{t as xe,N as be,I as ve,f as De,E as J,g as ke,o as Oe,W as Te,h as Ee,S as Me,i as Le,j as _e,A as Be,B as Ie,a as Pe,O as Ke,F as Re,H as ze,J as we,K as Ne,M as qe,C as Ae}from"./Checkroom-Df7u--dr.js";import{a as X,C as je,b as Ge,D as We}from"./UploadCard-vqCFQOAi.js";import{M as w,D as Q,d as Fe,C as He}from"./StatDisplay-DN_thmMF.js";import{S as T,b as $e,g as Ve,a as Je,C as Xe,u as Qe}from"./CharacterEditor-Wn3aIRtu.js";import{C as U}from"./CardHeader-BNwiKr2P.js";import{C as L,G as P}from"./Grid-BwNEbLl1.js";import{D as Ue,d as Ye}from"./BusinessCenter-CUrDm_-f.js";import{a as Ze,g as et,u as tt}from"./LightConeTrans-BoBfFZqr.js";import{b as nt}from"./RelicSetAutocomplete-M9YTYhRD.js";import{C as st}from"./CardActionArea-BVlWseCA.js";import{s as at,t as ot,w as F,l as rt,a as it,c as ct}from"./PathIcon-DiyEyK0s.js";import"./InfoTooltip-Di7anMxp.js";function E(t){const{database:e}=S();return H(e.charOpts,t)}function lt(){const{database:t}=S(),{key:e}=x(),{bonusStats:s}=E(e),a=r.useCallback((o,c,u)=>t.charOpts.setBonusStat(e,o,c,u),[t,e]),i=o=>{const c=ut(o,e);t.charOpts.setBonusStat(e,c,0)};return l(O,{children:[n(U,{title:"Bonus Stats"}),n(X,{}),n(L,{children:l(T,{spacing:1,children:[s.map(({tag:o,value:c},u)=>n(ht,{tag:o,value:c,setValue:p=>a(o,p),onDelete:()=>a(o,null),setTag:p=>a(p,0)},JSON.stringify(o)+u)),n(pt,{onSelect:i})]})})]})}function ut(t,e){return{src:e,dst:e,et:"own",q:t,qt:"premod",sheet:"agg"}}const dt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function pt({tag:t={},onSelect:e}){var s;return n(Q,{title:(t&&((s=xe.subset(t)[0])==null?void 0:s.title))??"Add Bonus Stat",children:dt.map(a=>n(w,{onClick:()=>e(a),children:a},a))})}function ht({tag:t,setTag:e,value:s,setValue:a,onDelete:i}){var c;const o=(c=t.name||t.q)==null?void 0:c.endsWith("_");return n(O,{bgt:"light",children:l(L,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[n(ne,{sx:{m:"auto"},children:t.q}),t.q==="dmg_"&&n(mt,{tag:t,setElementalType:u=>{const{elementalType:p,...h}=t;e(u?{...h,elementalType:u}:h)}}),n(be,{float:!0,value:s,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:a,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:l(ve,{position:"end",sx:{ml:0},children:[o?"%":void 0," ",n(se,{"aria-label":"Delete Bonus Stat",onClick:i,edge:"end",children:n(Ue,{fontSize:"small"})})]})}})]})})}function mt({tag:t,setElementalType:e}){return l(Q,{title:t.elementalType??"No Element",children:[n(w,{onClick:()=>e(null),children:"No Element"}),ae.map(s=>n(w,{onClick:()=>e(s),children:s},s))]})}const Ct=210,Y=r.createContext(Ct);function ft(){const{key:t}=x(),{conditionals:e}=E(t),[s,a]=r.useState(""),i=r.useMemo(()=>{const o=e.map(c=>c.sheet).filter(oe);return s&&o.push(s),[...new Set(o)].sort(c=>c===s?-1:1)},[e,s]);return l(T,{spacing:1,sx:{pt:1},children:[n(Ze,{lcKey:s,setLCKey:a,label:"Search Light Cone"}),n(m,{children:n(P,{container:!0,columns:3,spacing:1,children:i.map(o=>n(P,{item:!0,xs:1,children:n(De,{lcKey:o})},o))})})]})}function gt(t){const{database:e}=S();return H(e.generatedBuildList,t)}const yt=r.memo(function(){const{optConfig:e}=r.useContext($),s=gt(e.generatedBuildListId??"");return n(T,{spacing:1,children:s==null?void 0:s.builds.map((a,i)=>n(O,{children:l(L,{children:[l(m,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[l(I,{children:["Build ",i+1,": ",re(a.value)]}),n(St,{build:a})]}),n(J,{relicIds:a.relicIds,lightConeId:a.lightConeId})]})},`${i}-${a.lightConeId}-${Object.values(a.relicIds).join("-")}`))})});function St({build:{relicIds:t,lightConeId:e}}){const{t:s}=K("build"),{database:a}=S(),{key:i}=x(),o=r.useCallback(()=>{Object.entries(t).forEach(([c,u])=>a.chars.setEquippedRelic(i,c,u)),a.chars.setEquippedLightCone(i,e)},[i,a.chars,e,t]);return n(N,{color:"info",size:"small",startIcon:n(ke,{}),onClick:o,children:s("buildDisplay.equipToCrr")})}function xt(){const{key:t}=x(),{optConfigId:e}=E(t),{database:s}=S();return r.useEffect(()=>{if(e)return;const a=s.optConfigs.new();s.charOpts.set(t,{optConfigId:a})},[s,e,t]),e?l(ie,{optConfigId:e,children:[n(bt,{}),n(yt,{})]}):null}function bt(){const{t}=K("optimize"),{database:e}=S(),s=$e(),{key:a}=x(),{target:i}=E(a),[o,c]=r.useState(8),[u,p]=r.useState(void 0),{optConfig:h,optConfigId:_}=r.useContext($),k=r.useMemo(()=>e.relics.values.reduce((f,g)=>(f[g.slotKey].push(g),f),{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]}),[e.relics.values]),d=r.useMemo(()=>{const{path:f}=Ve(a);return e.lightCones.values.filter(({key:g})=>{const{path:M}=et(g);return f===M})},[a,e.lightCones.values]),b=r.useMemo(()=>Object.values(k).reduce((f,g)=>f*g.length,1)*d.length,[d.length,k]),[C,v]=r.useState(!1),D=r.useRef(()=>{});r.useEffect(()=>()=>D.current(),[]);const q=r.useCallback(async()=>{if(!s)return;const f=new Promise(y=>D.current=y);p(void 0),v(!0);const g=(h.statFilters??[]).filter(({disabled:y})=>!y).map(({tag:y,value:R,isMax:j})=>({tag:y,value:R,isMax:j})),M=Oe(a,s,[{tag:i,multiplier:1}],10,g,d,k,o,p);f.then(()=>M.terminate());const A=await M.results();M.terminate(),D.current=()=>{},v(!1),A.length&&e.optConfigs.newOrSetGeneratedBuildList(_,{builds:A.slice(0,5).map(({ids:y,value:R})=>({lightConeId:y[0],relicIds:V(ce,(j,te)=>y[te+1]),value:R})),buildDate:Date.now()})},[s,h.statFilters,a,i,d,k,o,e.optConfigs,_]),ee=r.useCallback(()=>{D.current(),v(!1)},[D]);return l(O,{children:[n(U,{title:t("optimize"),action:l(m,{children:[n(Te,{numWorkers:o,setNumWorkers:c}),n(N,{onClick:C?ee:q,color:C?"error":"primary",startIcon:C?n(Ye,{}):n(Ee,{}),children:t(C?"cancel":"optimize")})]})}),n(X,{}),l(L,{children:[n(Me,{}),u&&n(vt,{progress:u,totalPermutations:b})]})]})}function vt({progress:t,totalPermutations:e}){const{t:s}=K("optimize");return l(m,{children:[l(I,{children:[s("computed"),": ",t.computed.toLocaleString()," /"," ",(t.computed+t.remaining).toLocaleString()]}),l(I,{children:[s("computed + skipped"),":"," ",(t.computed+t.skipped).toLocaleString()," /"," ",e.toLocaleString()]}),n(Le,{variant:"determinate",value:(t.computed+t.skipped)/e*100})]})}function Dt(){const{key:t}=x(),{conditionals:e}=E(t),[s,a]=r.useState(""),i=r.useMemo(()=>{const o=e.map(c=>c.sheet).filter(le);return s&&o.push(s),[...new Set(o)].sort(c=>c===s?-1:1)},[e,s]);return l(T,{spacing:1,sx:{pt:1},children:[n(nt,{relicSetKey:s,setRelicSetKey:a,label:"Search Relic Set"}),n(m,{children:n(P,{container:!0,columns:3,spacing:1,children:i.map(o=>n(P,{item:!0,xs:1,children:n(_e,{setKey:o})},o))})})]})}const kt=0,z=33,Z=r.createContext(0);function Ot(){const t=r.useMemo(()=>[["char","Character",n(Et,{},"char")],["relicCond","Relic Conditionals",n(Dt,{},"relicCond")],["lightConeCond","Light Cone Conditionals",n(ft,{},"lightConeCond")],["opt","Optimize",n(Mt,{},"opt")]],[]);return n(Z.Provider,{value:t.length,children:n(T,{gap:1,children:t.map(([e,s,a],i)=>n(Tt,{title:s,index:i,children:a},e))})})}function Tt({index:t,title:e,children:s}){const[a,i]=Be(),o=r.useContext(Z),c=r.useContext(Y);return l(ue,{children:[n(O,{sx:u=>({outline:`solid ${u.palette.secondary.main}`,position:"sticky",top:c+t*z,bottom:kt+(o-1-t)*z,zIndex:100}),children:n(st,{onClick:i,sx:{px:1},children:n(I,{variant:"h6",children:e})})}),n(m,{ref:a,sx:{scrollMarginTop:c+(t+1)*z},children:s})]})}function Et(){const t=x(),{key:e}=t,[s,a]=r.useState(void 0);return l(T,{spacing:1,children:[l(m,{sx:{display:"flex",gap:1},children:[l(m,{sx:{minWidth:"350px"},children:[n(Je,{character:t}),n(Xe,{characterKey:s,onClose:()=>a(void 0)}),n(N,{fullWidth:!0,disabled:!e,onClick:()=>e&&a(e),children:"Edit Character"})]}),n(Lt,{})]}),n(lt,{}),n(Ie,{formulasRead:G.listing.formulas,buffsRead:G.listing.buffs})]})}function Mt(){return n(xt,{})}function Lt(){const{equippedRelics:t,equippedLightCone:e}=x();return n(O,{sx:{width:"100%"},children:n(L,{children:n(J,{relicIds:t,lightConeId:e})})})}function _t({character:t,charOpt:e,children:s}){const a=Bt(t),i=r.useMemo(()=>at([...ot([t.key]),...a,B.common.lvl.add(80),B.common.res.add(.1),B.common.isBroken.add(0),B.common.maxToughness.add(100),de.common.critMode.add("avg"),...e.conditionals.flatMap(({sheet:o,src:c,dst:u,condKey:p,condValue:h})=>F("preset0",pe(o,c,u)(p,h))),...e.bonusStats.flatMap(({tag:o,value:c})=>F("preset0",{tag:{...o},value:he(c)}))]),[t.key,a,e.conditionals,e.bonusStats]);return n(je.Provider,{value:i,children:s})}function Bt(t){const e=tt(t==null?void 0:t.equippedLightCone),s=me(t==null?void 0:t.equippedRelics),a=r.useMemo(()=>{const o=e;return o?rt(o.key,o.level,o.ascension,o.superimpose):[]},[e]),i=r.useMemo(()=>s?Pe(Object.values(s).filter(Ce)):[],[s]);return r.useMemo(()=>t?it(t.key,...ct(t,1),...a,...i):[],[t,a,i])}function It({character:{key:t},charOpt:{target:e}}){const{database:s}=S();return n(Ke,{optTarget:e,setOptTarget:a=>s.charOpts.set(t,{target:a}),buttonProps:{fullWidth:!0,sx:{height:"100%"}}})}function $t(){const{database:t}=S(),[e,s]=r.useState(fe[0]),{t:a}=K(["charNames_gen","page_character"]),i=Qe(e);r.useEffect(()=>{e&&!i&&t.chars.getOrCreate(e)},[e,i,t.chars]);const o=E(e);r.useEffect(()=>{e&&!o&&t.charOpts.getOrCreate(e)},[e,o,t.charOpts]),Re(r.useMemo(()=>`Optimize - ${a(e?"charNames_gen:Character":"Optimize")}`,[e,a]));const c=r.useMemo(()=>{const b=V(e?[e]:[],C=>n(He,{genderedKey:Fe(C)}));return{srcDisplay:b,dstDisplay:b}},[e]),u=r.useCallback((d,b,C,v,D)=>{!ge(d)||!W(C)||!(v===null||W(v))||!ye(d,b)||t.charOpts.setConditional(e,d,b,C,v,D)},[e,t.charOpts]),p=r.useMemo(()=>({src:e,dst:e,preset:"preset0"}),[e]),[h,_]=r.useState(),k=r.useMemo(()=>({read:h,setRead:_}),[h]);return l(m,{children:[n(Ae,{charKey:e,setCharKey:d=>d&&s(d)}),i&&o&&n(Se.Provider,{value:i,children:n(Ge.Provider,{value:p,children:n(_t,{character:i,charOpt:o,children:n(ze.Provider,{value:c,children:n(we.Provider,{value:o.conditionals,children:n(Ne.Provider,{value:u,children:l(We.Provider,{value:k,children:[n(qe,{}),l(m,{sx:{display:"flex",gap:1,flexDirection:"column",mt:2},children:[n(It,{character:i,charOpt:o}),n(Y.Provider,{value:0,children:n(Ot,{})})]})]})})})})})})})]})}export{$t as default};
