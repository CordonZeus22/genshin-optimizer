import{W as Ke,r as l,V as S,ah as Ce,m as N,p as c,B as x,a3 as le,o as e,R as J,L as Z,aV as Q,av as Y,au as O,z as y,Q as ae,I as te,as as Oe,ay as Te,az as E,T as K,ap as Ae,y as m,S as me,a1 as ce,aB as ee,a9 as ue,aW as se,aX as xe,aa as ye,aY as Se,H as be,aZ as oe,a2 as Le,a_ as _e,Z as he,aA as Pe,aC as qe,a6 as pe,ai as X,aj as Be,ak as ze,al as Ne,am as We,an as je,aT as Fe,aJ as He,aK as ge,aL as Ge,aM as $e}from"./index-SHvKIHba.js";import{t as Ve,N as Ue,I as Xe,f as Je,E as ve,g as Ze,P as V,o as Qe,S as Ye,W as et,h as tt,i as nt,j as it,A as st,B as ot,a as rt,O as lt,F as at,H as ct,J as dt,K as ut,M as ht,C as pt}from"./Checkroom-BcaFVn_I.js";import{a as q,L as gt,C as ft,b as Ct,D as mt}from"./UploadCard-BvoW0y1M.js";import{M,D as $,r as ke,b as xt,d as yt,C as St}from"./StatDisplay-DsrC3GaE.js";import{S as R,d as bt,c as Lt,b as vt,a as kt,C as wt,u as Rt}from"./CharacterEditor-CDhC0vrw.js";import{C as W}from"./CardHeader-B5uHyejC.js";import{C as L,G as P}from"./Grid-CargbIeK.js";import{D as Dt,d as ne}from"./BusinessCenter-OAS49FCG.js";import{a as Et,g as we,u as It}from"./LightConeTrans-CpYCvXmV.js";import{u as de}from"./useBoolState-CYEISYxo.js";import{a as Re,R as _,b as Mt}from"./RelicSetAutocomplete-CiwDj6En.js";import{C as Kt}from"./CardActionArea-LUpL1Zdh.js";import{s as Ot,t as Tt,w as fe,l as At,a as _t,c as Pt}from"./index-Dp3Z0RuH.js";import"./InfoTooltip-DTIN3Ovn.js";function re(n){const[t,i]=Ke();return l.useEffect(()=>n.followAny((s,r)=>r==="update"&&i()),[n,i]),t}function j(n){const{database:t}=S();return Ce(t.charOpts,n)}function qt({levelLow:n,levelHigh:t,setLow:i,setHigh:s,setBoth:r,dark:o=!1,disabled:a=!1,showLevelText:h=!1}){const{t:p}=N("lightcone"),[d,u]=l.useState(n),[v,g]=l.useState(t),k=l.useCallback((f,C)=>{if(typeof C=="number")throw new TypeError;const[D,T]=C;u(D),g(T)},[u,g]);return l.useEffect(()=>u(n),[u,n]),l.useEffect(()=>g(t),[g,t]),c(x,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:o?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[c(x,{sx:{width:"max-content",height:32,display:"flex"},children:[h?c(le,{children:[e("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),e(q,{orientation:"vertical",flexItem:!0})]}):void 0,e(Z,{value:d,onChange:f=>i(J(f??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:h?"right":"center"}},disabled:a})]}),e(Re,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"LightCone Level Range",value:[d,v],onChange:k,onChangeCommitted:(f,C)=>Array.isArray(C)&&r(C[0],C[1]),valueLabelDisplay:"auto",min:0,max:Q,step:1,marks:!0,disabled:a}),e(Z,{value:v,onChange:f=>s(J(f??0,n,Q)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Bt({levelLow:n,levelHigh:t,setLow:i,setHigh:s,setBoth:r,dark:o=!1,disabled:a=!1,showLevelText:h=!1}){const{t:p}=N("artifact"),[d,u]=l.useState(n),[v,g]=l.useState(t),k=l.useCallback((f,C)=>{if(typeof C=="number")throw new TypeError;const[D,T]=C;u(D),g(T)},[u,g]);return l.useEffect(()=>u(n),[u,n]),l.useEffect(()=>g(t),[g,t]),c(x,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:o?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[c(x,{sx:{width:"max-content",height:32,display:"flex"},children:[h?c(le,{children:[e("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:p("levelSliderTitle")}),e(q,{orientation:"vertical",flexItem:!0})]}):void 0,e(Z,{value:d,onChange:f=>i(J(f??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:h?"right":"center"}},disabled:a})]}),e(Re,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Arifact Level Range",value:[d,v],onChange:k,onChangeCommitted:(f,C)=>Array.isArray(C)&&r(C[0],C[1]),valueLabelDisplay:"auto",min:0,max:Y[5],step:1,marks:!0,disabled:a}),e(Z,{value:v,onChange:f=>s(J(f??0,n,Y[5])),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function zt(){const{database:n}=S(),{key:t}=O(),{bonusStats:i}=j(t),s=l.useCallback((o,a,h)=>n.charOpts.setBonusStat(t,o,a,h),[n,t]),r=o=>{const a=Nt(o,t);n.charOpts.setBonusStat(t,a,0)};return c(y,{children:[e(W,{title:"Bonus Stats"}),e(q,{}),e(L,{children:c(R,{spacing:1,children:[i.map(({tag:o,value:a},h)=>e(Ft,{tag:o,value:a,setValue:p=>s(o,p),onDelete:()=>s(o,null),setTag:p=>s(p,0)},JSON.stringify(o)+h)),e(jt,{onSelect:r})]})})]})}function Nt(n,t){return{src:t,dst:t,et:"own",q:n,qt:"premod",sheet:"agg"}}const Wt=["hp","hp_","def","def_","atk","atk_","spd","spd_","dmg_","enerRegen_","brEffect_","crit_","crit_dmg_","eff_","eff_res_","heal_"];function jt({tag:n={},onSelect:t}){var i;return e($,{title:(n&&((i=Ve.subset(n)[0])==null?void 0:i.title))??"Add Bonus Stat",children:Wt.map(s=>e(M,{onClick:()=>t(s),children:s},s))})}function Ft({tag:n,setTag:t,value:i,setValue:s,onDelete:r}){var a;const o=(a=n.name||n.q)==null?void 0:a.endsWith("_");return e(y,{bgt:"light",children:c(L,{sx:{display:"flex",gap:1,justifyContent:"space-around"},children:[e(ae,{sx:{m:"auto"},children:n.q}),n.q==="dmg_"&&e(Ht,{tag:n,setElementalType:h=>{const{elementalType:p,...d}=n;t(h?{...d,elementalType:h}:d)}}),e(Ue,{float:!0,value:i,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:s,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:c(Xe,{position:"end",sx:{ml:0},children:[o?"%":void 0," ",e(te,{"aria-label":"Delete Bonus Stat",onClick:r,edge:"end",children:e(Dt,{fontSize:"small"})})]})}})]})})}function Ht({tag:n,setElementalType:t}){return c($,{title:n.elementalType??"No Element",children:[e(M,{onClick:()=>t(null),children:"No Element"}),Oe.map(i=>e(M,{onClick:()=>t(i),children:i},i))]})}const Gt=210,De=l.createContext(Gt);function $t(){const{key:n}=O(),{conditionals:t}=j(n),[i,s]=l.useState(""),r=l.useMemo(()=>{const o=t.map(a=>a.sheet).filter(Te);return i&&o.push(i),[...new Set(o)].sort(a=>a===i?-1:1)},[t,i]);return c(R,{spacing:1,sx:{pt:1},children:[e(Et,{lcKey:i,setLCKey:s,label:"Search Light Cone"}),e(x,{children:e(P,{container:!0,columns:3,spacing:1,children:r.map(o=>e(P,{item:!0,xs:1,children:e(Je,{lcKey:o})},o))})})]})}function Vt(n){const{database:t}=S();return Ce(t.generatedBuildList,n)}const Ut=l.memo(function(){const{optConfig:t}=l.useContext(E),i=Vt(t.generatedBuildListId??"");return e(R,{spacing:1,children:i==null?void 0:i.builds.map((s,r)=>e(y,{children:c(L,{children:[c(x,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[c(K,{children:["Build ",r+1,": ",Ae(s.value)]}),e(Xt,{build:s})]}),e(ve,{relicIds:s.relicIds,lightConeId:s.lightConeId})]})},`${r}-${s.lightConeId}-${Object.values(s.relicIds).join("-")}`))})});function Xt({build:{relicIds:n,lightConeId:t}}){const{t:i}=N("build"),{database:s}=S(),{key:r}=O(),o=l.useCallback(()=>{Object.entries(n).forEach(([a,h])=>s.chars.setEquippedRelic(r,a,h)),s.chars.setEquippedLightCone(r,t)},[r,s.chars,t,n]);return e(m,{color:"info",size:"small",startIcon:e(Ze,{}),onClick:o,children:i("buildDisplay.equipToCrr")})}const Jt=l.memo(function({disabled:t=!1}){const{database:i}=S(),{optConfigId:s,optConfig:r}=l.useContext(E);return c(y,{bgt:"light",children:[e(L,{sx:{display:"flex",gap:1},children:e(K,{sx:{fontWeight:"bold"},children:"LightCone Level Filter"})}),e(q,{}),e(qt,{levelLow:(r==null?void 0:r.lcLevelLow)??Q,levelHigh:(r==null?void 0:r.lcLevelHigh)??Q,setLow:o=>i.optConfigs.set(s,{lcLevelLow:o}),setHigh:o=>i.optConfigs.set(s,{lcLevelHigh:o}),setBoth:(o,a)=>i.optConfigs.set(s,{lcLevelLow:o,lcLevelHigh:a}),disabled:t})]})});function Zt({numLightCone:n,disabled:t}){const{database:i}=S(),{optConfigId:s,optConfig:r}=l.useContext(E),[o,a,h]=de();return e(y,{bgt:"light",children:e(L,{children:c(R,{spacing:1,children:[c(V,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[c(V,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["LightCones:"," ",e(ae,{color:n?"primary":"error",children:n})]}),e(m,{sx:{flexGrow:1},startIcon:r.optLightCone?e(bt,{}):e(Lt,{}),color:r.optLightCone?"success":"secondary",onClick:()=>i.optConfigs.set(s,{optLightCone:!r.optLightCone}),children:"Optimize LightCone"})]}),e(Qt,{show:o,onClose:h}),e(m,{color:"info",fullWidth:!0,onClick:a,disabled:t||!r.optLightCone,children:"LightCone Filter Config"})]})})})}function Qt({show:n,onClose:t,disabled:i}){const{database:s}=S(),{optConfigId:r,optConfig:o}=l.useContext(E);return e(ce,{open:n,onClose:t,children:c(y,{children:[e(W,{title:"LightCone Filter",action:e(te,{onClick:t,children:e(ne,{})})}),e(q,{}),e(L,{children:e(l.Suspense,{fallback:e(me,{width:"100%",height:"500px"}),children:c(R,{spacing:1,children:[e(Jt,{disabled:i}),e(Yt,{disabled:i}),e(m,{disabled:i,onClick:()=>s.optConfigs.set(r,{useEquippedLightCone:!o.useEquippedLightCone}),color:o.useEquippedLightCone?"success":"secondary",children:"Use equipped LightCone"})]})})})]})})}function Yt({disabled:n}){const{database:t}=S(),{optConfigId:i,optConfig:s}=l.useContext(E),{lightConePaths:r}=s,o=re(t.lightCones),{key:a}=O(),h=l.useMemo(()=>o&&s.optLightCone?t.lightCones.values.reduce((p,{key:d,level:u,location:v})=>{if(u<s.lcLevelLow||u>s.lcLevelHigh||v&&!s.useEquippedLightCone&&v!==a)return p;const g=we(d).path;return g&&p[g]++,p},ee(ue,()=>0)):ee(ue,()=>0),[a,o,t.lightCones,s.lcLevelLow,s.lcLevelHigh,s.optLightCone,s.useEquippedLightCone]);return e(gt,{onChange:p=>t.optConfigs.set(i,{lightConePaths:p}),value:r,disabled:n,totals:h,fullWidth:!0})}const en=l.memo(function({disabled:t=!1}){const{database:i}=S(),{optConfigId:s,optConfig:r}=l.useContext(E);return c(y,{bgt:"light",children:[e(L,{sx:{display:"flex",gap:1},children:e(K,{sx:{fontWeight:"bold"},children:"Relic Level Filter"})}),e(q,{}),e(Bt,{levelLow:(r==null?void 0:r.levelLow)??Y[5],levelHigh:(r==null?void 0:r.levelHigh)??Y[5],setLow:o=>i.optConfigs.set(s,{levelLow:o}),setHigh:o=>i.optConfigs.set(s,{levelHigh:o}),setBoth:(o,a)=>i.optConfigs.set(s,{levelLow:o,levelHigh:a}),disabled:t})]})});function tn({disabled:n=!1,setFilter4Cavern:t,setFilter2Cavern:i,setFilter2Planar:s,setSetFilter4Cavern:r,setSetFilter2Cavern:o,setSetFilter2Planar:a}){const[h,p,d]=de();return c(y,{bgt:"light",children:[e(ce,{open:h,onClose:d,children:e(nn,{onClose:d,setFilter2Cavern:i,setFilter4Cavern:t,setFilter2Planar:s,setSetFilter2Cavern:o,setSetFilter4Cavern:r,setSetFilter2Planar:a})}),c(L,{sx:{display:"flex",gap:1},children:[c(x,{sx:{flexGrow:1,display:"flex",gap:1,flexDirection:"column"},children:[t.length<=1?c($,{disabled:n,title:t[0]?c("span",{children:["Force 4-Set:"," ",e("strong",{children:e(_,{setKey:t[0]})})]}):"Select to force 4-Set",sx:{flexGrow:1},children:[e(M,{onClick:()=>r([]),children:"No 4-Set"}),se.map(u=>e(M,{onClick:()=>r([u]),children:e(_,{setKey:u})},u))]}):e(m,{disabled:!0,children:c("span",{children:[e("strong",{children:t.length})," Relic 4p-set Selected"]})}),i.length<=1?c($,{disabled:n,title:i[0]?c("span",{children:["Force 2-Set:"," ",e("strong",{children:e(_,{setKey:i[0]})})]}):"Select to force 2-Set",sx:{flexGrow:1},children:[e(M,{onClick:()=>o([]),children:"No 2-Set"}),se.map(u=>e(M,{onClick:()=>o([u]),children:e(_,{setKey:u})},u))]}):e(m,{disabled:!0,children:c("span",{children:[e("strong",{children:i.length})," Relic Cavern 2p-set Selected"]})}),s.length<=1?c($,{disabled:n,title:s[0]?c("span",{children:["Force 2-Set:"," ",e("strong",{children:e(_,{setKey:s[0]})})]}):"Select to force 2-Set",sx:{flexGrow:1},children:[e(M,{onClick:()=>a([]),children:"No 2-Set"}),xe.map(u=>e(M,{onClick:()=>a([u]),children:e(_,{setKey:u})},u))]}):e(m,{disabled:!0,children:c("span",{children:[e("strong",{children:s.length})," Relic Planar 2p-set Selected"]})})]}),e(x,{sx:{display:"flex",alignItems:"stretch"},children:e(m,{disabled:n,onClick:p,color:"info",children:"Advanced Set-Filter Config"})})]})]})}function nn({onClose:n,setFilter4Cavern:t,setFilter2Cavern:i,setFilter2Planar:s,setSetFilter4Cavern:r,setSetFilter2Cavern:o,setSetFilter2Planar:a}){return c(y,{children:[e(W,{title:"Advanced Set-Filter Config",action:e(te,{onClick:n,children:e(ne,{})})}),e(q,{}),c(L,{children:[e(K,{variant:"h6",children:"Cavern"}),c(x,{sx:{display:"flex",gap:1,mb:1},children:[e(m,{disabled:!t.length,onClick:()=>r([]),children:"Reset 4p filter"}),e(m,{disabled:!i.length,onClick:()=>o([]),children:"Reset 2p filter"})]}),e(P,{container:!0,spacing:1,children:se.map(h=>e(P,{item:!0,xs:1,md:2,lg:3,children:e(sn,{setKey:h,setFilter4Cavern:t,setFilter2Cavern:i,setSetFilter4Cavern:r,setSetFilter2Cavern:o})},h))}),e(K,{variant:"h6",children:"Planar"}),e(x,{sx:{display:"flex",gap:1,mb:1},children:e(m,{disabled:!i.length,onClick:()=>a([]),children:"Reset 2p filter"})}),e(P,{container:!0,spacing:1,children:xe.map(h=>e(P,{item:!0,xs:1,md:2,lg:3,children:e(on,{setKey:h,setFilter2Planar:s,setSetFilter2Planar:a})},h))})]})]})}function sn({setKey:n,setFilter4Cavern:t,setFilter2Cavern:i,setSetFilter4Cavern:s,setSetFilter2Cavern:r}){return c(y,{bgt:"light",children:[e(W,{title:e(_,{setKey:n}),avatar:e(ye,{src:ke(n,Se(n)),size:2})}),c(be,{fullWidth:!0,children:[e(m,{color:!t.length||t.includes(n)?"success":"secondary",onClick:()=>s(t.length?oe([...t],n):[n]),children:"Allow 4p"}),e(m,{color:!i.length||i.includes(n)?"success":"secondary",onClick:()=>r(i.length?oe([...i],n):[n]),children:"Allow 2p"})]})]})}function on({setKey:n,setFilter2Planar:t,setSetFilter2Planar:i}){return c(y,{bgt:"light",children:[e(W,{title:e(_,{setKey:n}),avatar:e(ye,{src:ke(n,Se(n)),size:2})}),e(be,{fullWidth:!0,children:e(m,{color:!t.length||t.includes(n)?"success":"secondary",onClick:()=>i(t.length?oe([...t],n):[n]),children:"Allow 2p"})})]})}function rn({relicsBySlot:n}){const[t,i,s]=de();return e(y,{bgt:"light",children:e(L,{children:c(R,{spacing:1,children:[e(V,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:Le.map(r=>e(z,{relicsBySlot:n,slotKey:r},r))}),e(ln,{show:t,onClose:s,relicsBySlot:n}),e(m,{color:"info",fullWidth:!0,onClick:i,children:"Relic Filter Config"})]})})})}function z({relicsBySlot:n,slotKey:t}){return c(K,{children:["Relic ",t," ",e(ae,{color:n[t].length?"primary":"error",children:n[t].length})]})}function ln({relicsBySlot:n,show:t,onClose:i,disabled:s}){const{database:r}=S(),{optConfigId:o,optConfig:a}=l.useContext(E);return e(ce,{open:t,onClose:i,children:c(y,{children:[e(W,{title:"Relic Filter",action:e(te,{onClick:i,children:e(ne,{})})}),e(q,{}),e(L,{children:e(l.Suspense,{fallback:e(me,{width:"100%",height:"500px"}),children:c(R,{spacing:1,children:[e(en,{disabled:s}),e(an,{relicsBySlot:n,disabled:s}),e(cn,{disabled:s}),e(m,{disabled:s,onClick:()=>r.optConfigs.set(o,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Relics"})]})})})]})})}function an({relicsBySlot:n,disabled:t}){const{database:i}=S(),{optConfigId:s,optConfig:r}=l.useContext(E),o=a=>{const h=_e([...he[a]]),p={body:r.slotBodyKeys??[],feet:r.slotFeetKeys??[],sphere:r.slotSphereKeys??[],rope:r.slotRopeKeys??[]},d={body:u=>i.optConfigs.set(s,{slotBodyKeys:u}),feet:u=>i.optConfigs.set(s,{slotFeetKeys:u}),sphere:u=>i.optConfigs.set(s,{slotSphereKeys:u}),rope:u=>i.optConfigs.set(s,{slotRopeKeys:u})};return e(V,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:he[a].map(u=>e(m,{disabled:t,variant:p[a].includes(u)?"contained":"outlined",onClick:()=>d[a](h([...p[a]],u)),children:e(xt,{statKey:u,showPercent:!0})},u))})};return e(y,{bgt:"light",children:e(L,{children:c(R,{spacing:1,children:[c(V,{sx:{display:"flex",justifyContent:"space-between"},children:[e(z,{slotKey:"head",relicsBySlot:n}),e(z,{slotKey:"hands",relicsBySlot:n})]}),e(z,{slotKey:"body",relicsBySlot:n}),o("body"),e(z,{slotKey:"feet",relicsBySlot:n}),o("feet"),e(z,{slotKey:"sphere",relicsBySlot:n}),o("sphere"),e(z,{slotKey:"rope",relicsBySlot:n}),o("rope")]})})})}function cn({disabled:n}){const{database:t}=S(),{optConfigId:i,optConfig:s}=l.useContext(E),{setFilter4Cavern:r,setFilter2Cavern:o,setFilter2Planar:a}=s,h=l.useCallback(u=>{t.optConfigs.set(i,{setFilter2Cavern:u})},[t,i]),p=l.useCallback(u=>{t.optConfigs.set(i,{setFilter4Cavern:u})},[t,i]),d=l.useCallback(u=>{t.optConfigs.set(i,{setFilter2Planar:u})},[t,i]);return e(tn,{disabled:n,setFilter2Cavern:o,setFilter4Cavern:r,setFilter2Planar:a,setSetFilter2Cavern:h,setSetFilter4Cavern:p,setSetFilter2Planar:d})}function dn(){const{key:n}=O(),{optConfigId:t}=j(n),{database:i}=S();return l.useEffect(()=>{if(t)return;const s=i.optConfigs.new();i.charOpts.set(n,{optConfigId:s})},[i,t,n]),t?c(Pe,{optConfigId:t,children:[e(un,{}),e(Ut,{})]}):null}function un(){const{t:n}=N("optimize"),{database:t}=S(),i=vt(),{key:s}=O(),{target:r}=j(s),[o,a]=l.useState(8),[h,p]=l.useState(void 0),{optConfig:d,optConfigId:u}=l.useContext(E),v=re(t.relics),g=l.useMemo(()=>{const B={body:d.slotBodyKeys,feet:d.slotFeetKeys,sphere:d.slotSphereKeys,rope:d.slotRopeKeys},A=b=>["body","feet","sphere","rope"].includes(b);return v&&t.relics.values.reduce((b,I)=>{const{slotKey:w,mainStatKey:H,level:G,location:U}=I;return G<d.levelLow||G>d.levelHigh||U&&!d.useEquipped&&U!==s||A(w)&&!B[w].includes(H)||b[I.slotKey].push(I),b},{head:[],hands:[],feet:[],body:[],sphere:[],rope:[]})},[s,t.relics,d.levelHigh,d.levelLow,d.slotBodyKeys,d.slotFeetKeys,d.slotRopeKeys,d.slotSphereKeys,d.useEquipped,v]),k=re(t.lightCones),f=l.useMemo(()=>k&&t.lightCones.values.filter(({key:B,level:A,location:b})=>{if(!d.optLightCone)return b===s;if(A<d.lcLevelLow||A>d.lcLevelHigh||b&&!d.useEquippedLightCone&&b!==s)return!1;const{path:I}=we(B);return!!d.lightConePaths.includes(I)}),[s,t.lightCones,d.lcLevelLow,d.lcLevelHigh,d.optLightCone,d.lightConePaths,d.useEquippedLightCone,k]),C=l.useMemo(()=>Object.values(g).reduce((B,A)=>B*A.length,1)*f.length,[f.length,g]),[D,T]=l.useState(!1),F=l.useRef(()=>{});l.useEffect(()=>()=>F.current(),[]);const Ie=l.useCallback(async()=>{if(!i)return;const B=new Promise(w=>F.current=w);p(void 0),T(!0);const A=(d.statFilters??[]).filter(({disabled:w})=>!w).map(({tag:w,value:H,isMax:G})=>({tag:w,value:H,isMax:G})),b=Qe(s,i,[{tag:r,multiplier:1}],10,A,d.setFilter2Cavern,d.setFilter4Cavern,d.setFilter2Planar,f,g,o,p);B.then(()=>b.terminate("user cancelled"));let I;try{I=await b.results}catch{return}finally{F.current=()=>{},T(!1)}I.length&&t.optConfigs.newOrSetGeneratedBuildList(u,{builds:I.slice(0,5).map(({ids:w,value:H})=>({lightConeId:w[0],relicIds:ee(Le,(G,U)=>w[U+1]),value:H})),buildDate:Date.now()})},[i,d.statFilters,d.setFilter2Cavern,d.setFilter4Cavern,d.setFilter2Planar,s,r,f,g,o,t.optConfigs,u]),Me=l.useCallback(()=>{F.current(),T(!1)},[F]);return e(y,{children:e(L,{children:c(R,{spacing:1,children:[e(Ye,{}),e(Zt,{numLightCone:f.length}),e(rn,{relicsBySlot:g}),h&&e(hn,{progress:h,totalPermutations:C}),c(x,{sx:{display:"flex",justifyContent:"space-between"},children:[e(et,{numWorkers:o,setNumWorkers:a}),e(m,{disabled:!C,onClick:D?Me:Ie,color:D?"error":"primary",startIcon:D?e(ne,{}):e(tt,{}),children:n(D?"cancel":"optimize")})]})]})})})}function hn({progress:n,totalPermutations:t}){const{t:i}=N("optimize");return c(x,{children:[c(K,{children:[i("computed"),": ",n.computed.toLocaleString()," /"," ",(n.computed+n.remaining).toLocaleString()]}),c(K,{children:[i("computed + skipped"),":"," ",(n.computed+n.skipped).toLocaleString()," /"," ",t.toLocaleString()]}),e(nt,{variant:"determinate",value:(n.computed+n.skipped)/t*100})]})}function pn(){const{key:n}=O(),{conditionals:t}=j(n),[i,s]=l.useState(""),r=l.useMemo(()=>{const o=t.map(a=>a.sheet).filter(qe);return i&&o.push(i),[...new Set(o)].sort(a=>a===i?-1:1)},[t,i]);return c(R,{spacing:1,sx:{pt:1},children:[e(Mt,{relicSetKey:i,setRelicSetKey:s,label:"Search Relic Set"}),e(x,{children:e(P,{container:!0,columns:3,spacing:1,children:r.map(o=>e(P,{item:!0,xs:1,children:e(it,{setKey:o})},o))})})]})}const gn=0,ie=33,Ee=l.createContext(0);function fn(){const n=l.useMemo(()=>[["char","Character",e(mn,{},"char")],["relicCond","Relic Conditionals",e(pn,{},"relicCond")],["lightConeCond","Light Cone Conditionals",e($t,{},"lightConeCond")],["opt","Optimize",e(xn,{},"opt")]],[]);return e(Ee.Provider,{value:n.length,children:e(R,{gap:1,children:n.map(([t,i,s],r)=>e(Cn,{title:i,index:r,children:s},t))})})}function Cn({index:n,title:t,children:i}){const[s,r]=st(),o=l.useContext(Ee),a=l.useContext(De);return c(le,{children:[e(y,{sx:h=>({outline:`solid ${h.palette.secondary.main}`,position:"sticky",top:a+n*ie,bottom:gn+(o-1-n)*ie,zIndex:100}),children:e(Kt,{onClick:r,sx:{px:1},children:e(K,{variant:"h6",children:t})})}),e(x,{ref:s,sx:{scrollMarginTop:a+(n+1)*ie},children:i})]})}function mn(){const n=O(),{key:t}=n,[i,s]=l.useState(void 0);return c(R,{spacing:1,children:[c(x,{sx:{display:"flex",gap:1},children:[c(x,{sx:{minWidth:"350px"},children:[e(kt,{character:n}),e(wt,{characterKey:i,onClose:()=>s(void 0)}),e(m,{fullWidth:!0,disabled:!t,onClick:()=>t&&s(t),children:"Edit Character"})]}),e(yn,{})]}),e(zt,{}),e(ot,{formulasRead:pe.listing.formulas,buffsRead:pe.listing.buffs})]})}function xn(){return e(dn,{})}function yn(){const{equippedRelics:n,equippedLightCone:t}=O();return e(y,{sx:{width:"100%"},children:e(L,{children:e(ve,{relicIds:n,lightConeId:t})})})}function Sn({character:n,charOpt:t,children:i}){const s=bn(n),r=l.useMemo(()=>Ot([...Tt([n.key]),...s,X.common.lvl.add(80),X.common.res.add(.1),X.common.isBroken.add(0),X.common.maxToughness.add(100),Be.common.critMode.add("avg"),...t.conditionals.flatMap(({sheet:o,src:a,dst:h,condKey:p,condValue:d})=>fe("preset0",ze(o,a,h)(p,d))),...t.bonusStats.flatMap(({tag:o,value:a})=>fe("preset0",{tag:{...o},value:Ne(a)}))]),[n.key,s,t.conditionals,t.bonusStats]);return e(ft.Provider,{value:r,children:i})}function bn(n){const t=It(n==null?void 0:n.equippedLightCone),i=We(n==null?void 0:n.equippedRelics),s=l.useMemo(()=>{const o=t;return o?At(o.key,o.level,o.ascension,o.superimpose):[]},[t]),r=l.useMemo(()=>i?rt(Object.values(i).filter(je)):[],[i]);return l.useMemo(()=>n?_t(n.key,...Pt(n,1),...s,...r):[],[n,s,r])}function Ln({character:{key:n},charOpt:{target:t}}){const{database:i}=S();return e(lt,{optTarget:t,setOptTarget:s=>i.charOpts.set(n,{target:s}),buttonProps:{fullWidth:!0,sx:{height:"100%"}}})}function qn(){const{database:n}=S(),[t,i]=l.useState(Fe[0]),{t:s}=N(["charNames_gen","page_character"]),r=Rt(t);l.useEffect(()=>{t&&!r&&n.chars.getOrCreate(t)},[t,r,n.chars]);const o=j(t);l.useEffect(()=>{t&&!o&&n.charOpts.getOrCreate(t)},[t,o,n.charOpts]),at(l.useMemo(()=>`Optimize - ${s(t?"charNames_gen:Character":"Optimize")}`,[t,s]));const a=l.useMemo(()=>{const k=ee(t?[t]:[],f=>e(St,{genderedKey:yt(f)}));return{srcDisplay:k,dstDisplay:k}},[t]),h=l.useCallback((g,k,f,C,D)=>{!He(g)||!ge(f)||!(C===null||ge(C))||!Ge(g,k)||n.charOpts.setConditional(t,g,k,f,C,D)},[t,n.charOpts]),p=l.useMemo(()=>({src:t,dst:t,preset:"preset0"}),[t]),[d,u]=l.useState(),v=l.useMemo(()=>({read:d,setRead:u}),[d]);return c(x,{children:[e(pt,{charKey:t,setCharKey:g=>g&&i(g)}),r&&o&&e($e.Provider,{value:r,children:e(Ct.Provider,{value:p,children:e(Sn,{character:r,charOpt:o,children:e(ct.Provider,{value:a,children:e(dt.Provider,{value:o.conditionals,children:e(ut.Provider,{value:h,children:c(mt.Provider,{value:v,children:[e(ht,{}),c(x,{sx:{display:"flex",gap:1,flexDirection:"column",mt:2},children:[e(Ln,{character:r,charOpt:o}),e(De.Provider,{value:0,children:e(fn,{})})]})]})})})})})})})]})}export{qn as default};
